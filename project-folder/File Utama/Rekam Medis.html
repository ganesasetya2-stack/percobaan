<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kartu Status Askesgilut - JKG | Politeknik Kesehatan Kemenkes Bandung</title>
    
    <!-- SEMUA LIBRARY LOKAL -->
    <script>
      // Suppress Tailwind warning
      window.tailwind = { config: { important: false } };
    </script>
    <script src="./lib/tailwind.js"></script>
    <script src="./lib/chart.js"></script>
    <link href="./lib/font-awesome.css" rel="stylesheet" />
    <script src="./lib/xlsx.full.min.js"></script>
    <script src="./lib/signature_pad.umd.min.js"></script>
    <script src="./lib/jspdf.umd.min.js"></script>
    <script src="./lib/html2canvas.min.js"></script>
    <script src="./lib/supabase-js.js"></script>

    <style>
      :root {
        --primary: #0ea5e9;
        --primary-dark: #0284c7;
        --secondary: #10b981;
        --accent: #f59e0b;
        --light-bg: #f8fafc;
        --card-bg: #ffffff;
        --text-dark: #1e293b;
        --text-light: #64748b;
        --dental-blue: #0ea5e9;
        --dental-green: #10b981;
        --dental-teal: #14b8a6;
        --dental-light: #e0f2fe;
      }

      body {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        font-family: "Inter", "Segoe UI", system-ui, sans-serif;
        min-height: 100vh;
      }

      .clinical-bg {
        background: linear-gradient(
            rgba(14, 165, 233, 0.05),
            rgba(14, 165, 233, 0.02)
          ),
          url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="none"><defs><pattern id="medical" patternUnits="userSpaceOnUse" width="20" height="20"><circle cx="10" cy="10" r="1" fill="%230ea5e9" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23medical)"/></svg>');
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(14, 165, 233, 0.1);
      }

      .dental-gradient {
        background: linear-gradient(
          135deg,
          var(--dental-blue),
          var(--dental-teal)
        );
      }

      .nav-active {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
      }

      .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
      }

      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .btn-secondary {
        background: linear-gradient(135deg, #64748b, #475569);
        color: white;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
      }

      .btn-secondary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(100, 116, 139, 0.4);
      }

      .section-card {
        background: var(--card-bg);
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(14, 165, 233, 0.08);
        border: 1px solid rgba(14, 165, 233, 0.1);
        transition: all 0.3s ease;
      }

      .section-card:hover {
        box-shadow: 0 8px 30px rgba(14, 165, 233, 0.12);
        transform: translateY(-2px);
      }

      /* Tooth Grid System */
      .tooth-grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 8px;
        margin: 1rem 0;
        padding: 1rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      .jaw-label {
        grid-column: 1 / -1;
        text-align: center;
        font-weight: bold;
        margin: 0.5rem 0;
        color: var(--text-dark);
      }

      .tooth-icon {
        width: 40px;
        height: 40px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 12px;
        color: white;
        position: relative;
        overflow: hidden;
        border: 2px solid transparent;
      }

      .tooth-icon.selected {
        border-color: #000;
        box-shadow: 0 0 0 2px #000;
      }

      .tooth-icon::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .tooth-icon:hover::before {
        left: 100%;
      }

      .tooth-icon:hover {
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      /* Tooth condition colors */
      .condition-0 {
        background: linear-gradient(135deg, #10b981, #059669);
      }
      .condition-1 {
        background: linear-gradient(135deg, #ef4444, #dc2626);
      }
      .condition-2 {
        background: linear-gradient(135deg, #f59e0b, #d97706);
      }
      .condition-3 {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
      }
      .condition-4 {
        background: linear-gradient(135deg, #6b7280, #4b5563);
      }
      .condition-5 {
        background: linear-gradient(135deg, #9ca3af, #6b7280);
      }
      .condition-6 {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      }
      .condition-7 {
        background: linear-gradient(135deg, #06b6d4, #0891b2);
      }
      .condition-8 {
        background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
        color: #64748b;
        border: 1px solid #cbd5e1;
      }
      .condition-9 {
        background: linear-gradient(135deg, #ec4899, #db2777);
      }

      /* Form Navigation */
      .form-navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid #e2e8f0;
      }

      .section-indicator {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }

      .section-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #cbd5e1;
        transition: all 0.3s ease;
      }

      .section-dot.active {
        background: var(--primary);
        transform: scale(1.2);
      }

      .hidden {
        display: none !important;
      }

      .floating-action {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 50;
      }

      .medical-icon {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      @keyframes pulse-glow {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(14, 165, 233, 0.3);
        }
        50% {
          box-shadow: 0 0 30px rgba(14, 165, 233, 0.6);
        }
      }

      .pulse-glow {
        animation: pulse-glow 2s infinite;
      }

      /* Form Styles */
      .form-input {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid #d1d5db;
        border-radius: 0.75rem;
        transition: all 0.3s ease;
        font-family: inherit;
      }

      .form-input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: #374151;
        margin-bottom: 0.5rem;
      }

      /* Odontogram Modal */
      .tooth-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .tooth-condition-option {
        padding: 0.75rem 1rem;
        margin: 0.25rem 0;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.2s;
        border: 2px solid transparent;
      }

      .tooth-condition-option:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-color: #000;
      }

      .tooth-condition-option.selected {
        border-color: #000;
        box-shadow: 0 0 0 2px #000;
      }

      /* Validation Styles */
      .error-message {
        color: #ef4444;
        font-size: 0.75rem;
        margin-top: 0.25rem;
        display: none;
      }

      .form-input.error {
        border-color: #ef4444;
      }

      .form-input.error:focus {
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
      }

      /* Loading States */
      .loading {
        opacity: 0.6;
        pointer-events: none;
      }

      /* Text Group Styles */
      .text-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      /* Condition Legend */
      .condition-legend {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .legend-item {
        display: flex;
        align-items: center;
        font-size: 0.75rem;
      }

      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        margin-right: 0.5rem;
      }

      /* Style untuk tombol alat yang aktif */
      .tool-button.active {
        transform: scale(1.05);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
      }

      /* Style untuk bagian gigi saat di-hover */
      .tooth-part:hover {
        opacity: 0.7;
      }

      /* Style untuk grup overlay (Hilang/Ekstraksi) */
      .tooth-overlay-group {
        display: none;
      }

      /* Ukuran font kustom untuk overlay 3+ karakter */
      .text-3xl-overlay {
        font-size: 1.875rem;
        line-height: 2.25rem;
      }

      .text-4xl-overlay {
        font-size: 2.25rem;
        line-height: 2.5rem;
      }

      /* Style untuk input tabel keterangan */
      .status-input {
        border: none;
        border-bottom: 1px solid #9ca3af;
        width: 100%;
        padding: 2px 4px;
        font-size: 0.875rem;
        outline: none;
        background-color: transparent;
      }

      .status-input:focus {
        border-bottom: 2px solid #3b82f6;
      }

      /* Style kustom untuk kotak-kotak plak agar sesuai dengan gambar */
      .plaque-box {
        width: 32px;
        height: 32px;
        border: 1px solid black;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.25rem;
        color: black;
        background-color: white;
        line-height: 1;
      }
      .tooth-number {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: 600;
      }
      .plaque-box-inner-number {
        width: 32px;
        height: 32px;
        border: 1px solid black;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: 600;
        background-color: white;
      }
      /* Input kecil untuk OHI-S - DIPERBAIKI */
      .ohis-input {
        width: 32px;
        height: 32px;
        border: 1px solid black;
        text-align: center;
        padding: 2px;
        border-radius: 0;
      }
      /* Garis pemisah tebal */
      .thick-divider {
        border-bottom: 3px solid black;
        margin-top: 4px;
        margin-bottom: 4px;
      }
      /* Style untuk garis vertikal pemisah */
      .vertical-divider {
        position: absolute;
        left: 50%;
        top: 0;
        bottom: 0;
        width: 3px;
        background-color: black;
        transform: translateX(-1.5px);
      }

      /* --- CSS BARU UNTUK KOTAK PLAK INTERAKTIF --- */
      .plaque-tooth {
        width: 32px;
        height: 32px;
        border: 1px solid black;
        position: relative;
        background-color: white;
      }

      .surface {
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: transparent;
        cursor: pointer;
        transition: background-color 0.1s ease;
      }

      .surface:hover {
        background-color: rgba(255, 192, 203, 0.5);
      }

      /* Mendefinisikan 4 permukaan (segitiga) menggunakan clip-path */
      /* Top (Facial/Buccal) */
      .surface-f {
        clip-path: polygon(0 0, 100% 0, 50% 50%);
      }
      /* Bottom (Lingual/Palatal) */
      .surface-l {
        clip-path: polygon(0 100%, 100% 100%, 50% 50%);
      }
      /* Left (Mesial) */
      .surface-m {
        clip-path: polygon(0 0, 0 100%, 50% 50%);
      }
      /* Right (Distal) */
      .surface-d {
        clip-path: polygon(100% 0, 100% 100%, 50% 50%);
      }

      /* Kelas 'selected' untuk menandai plak */
      .surface.selected {
        background-color: #ef4444;
      }

      /* Style untuk canvas tanda tangan */
      .signature-canvas {
        width: 100%;
        height: 150px;
        border: 1px dashed #a0aec0;
        border-radius: 0.5rem;
        background-color: #f7fafc;
        cursor: crosshair;
      }
      .uploaded-signature-preview {
        max-width: 100%;
        max-height: 150px;
        display: block;
        margin-top: 0.5rem;
        border: 1px solid #e2e8f0;
        border-radius: 0.25rem;
      }

      /* Radio button kustom minimalis */
      input[type="radio"] {
        width: 1.15em;
        height: 1.15em;
        margin-right: 0.3em;
        accent-color: #3b82f6;
      }
      .radio-label {
        display: flex;
        align-items: center;
        margin-right: 10px;
        font-size: 0.9rem;
      }

      /* Responsive improvements */
      @media (max-width: 768px) {
        .tooth-grid {
          grid-template-columns: repeat(4, 1fr);
        }
        .form-navigation {
          flex-direction: column;
          gap: 1rem;
        }
        .section-tab {
          font-size: 0.75rem;
          padding: 0.5rem 0.75rem;
        }
        .text-group {
          grid-template-columns: 1fr;
        }
        .condition-legend {
          grid-template-columns: 1fr 1fr;
        }
      }

      @media (max-width: 480px) {
        .tooth-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .condition-legend {
          grid-template-columns: 1fr;
        }
      }

      /* Style untuk modal data pasien */
      .patient-data-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 1rem;
      }

      .patient-data-content {
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        max-width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        width: 1000px;
      }

      .data-section {
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e5e7eb;
      }

      .data-section:last-child {
        border-bottom: none;
      }
    </style>
  </head>
  <body class="clinical-bg min-h-screen">
    <!-- Login Screen -->
    <div
      id="loginScreen"
      class="min-h-screen flex items-center justify-center px-4"
    >
      <div class="max-w-md w-full glass-card rounded-3xl p-8 space-y-8">
        <div class="text-center">
          <div
            class="w-20 h-20 mx-auto mb-4 rounded-2xl dental-gradient flex items-center justify-center"
          >
            <i class="fas fa-tooth text-white text-3xl"></i>
          </div>
          <h1
            class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-500 bg-clip-text text-transparent"
          >
            Kartu Status Askesgilut
          </h1>
          <p class="mt-2 text-gray-600 text-lg">
            JKG | Politeknik Kesehatan Kemenkes Bandung
          </p>
          <p class="mt-1 text-sm text-gray-500">D4 Terapi Gigi</p>
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="space-y-6">
          <div class="space-y-4">
            <div>
              <label
                for="loginEmail"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                <i class="fas fa-envelope medical-icon mr-2"></i>
                Email
              </label>
              <input
                type="email"
                id="loginEmail"
                required
                class="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300"
                placeholder="admin@poltekkes.ac.id"
              />
              <div class="error-message" id="loginEmailError">
                Email harus diisi dengan format yang valid
              </div>
            </div>
            <div>
              <label
                for="loginPassword"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                <i class="fas fa-lock medical-icon mr-2"></i>
                Kata Sandi
              </label>
              <div class="relative">
                <input
                  type="password"
                  id="loginPassword"
                  required
                  class="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300"
                  placeholder="admin123"
                />
                <button
                  type="button"
                  id="toggleLoginPassword"
                  class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <div class="error-message" id="loginPasswordError">
                Kata sandi harus diisi
              </div>
            </div>
          </div>

          <button
            type="submit"
            class="w-full btn-primary py-4 rounded-xl font-semibold text-lg transition-all duration-300 pulse-glow"
          >
            <i class="fas fa-sign-in-alt mr-2"></i>
            Masuk ke Sistem
          </button>
        </form>

        <div class="text-center">
          <button
            type="button"
            id="showRegister"
            class="text-blue-600 hover:text-blue-800 font-medium"
          >
            Belum punya akun? Daftar di sini
          </button>
        </div>
      </div>
    </div>

    <!-- Register Modal -->
    <div
      id="registerModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
    >
      <div
        class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto"
      >
        <div class="text-center mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Daftar Akun Baru</h2>
        </div>

        <form id="registerForm" class="space-y-4">
          <div>
            <label
              for="registerName"
              class="block text-sm font-semibold text-gray-700 mb-2"
            >
              Nama Lengkap
            </label>
            <input
              type="text"
              id="registerName"
              required
              class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent form-input"
              placeholder="Masukkan nama lengkap"
            />
            <div class="error-message" id="registerNameError">
              Nama lengkap harus diisi
            </div>
          </div>
          <div>
            <label
              for="registerNIM"
              class="block text-sm font-semibold text-gray-700 mb-2"
            >
              NIM
            </label>
            <input
              type="text"
              id="registerNIM"
              required
              class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent form-input"
              placeholder="Masukkan NIM"
            />
            <div class="error-message" id="registerNIMError">
              NIM harus diisi
            </div>
          </div>
          <div>
            <label
              for="registerEmail"
              class="block text-sm font-semibold text-gray-700 mb-2"
            >
              Email
            </label>
            <input
              type="email"
              id="registerEmail"
              required
              class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent form-input"
              placeholder="Masukkan email"
            />
            <div class="error-message" id="registerEmailError">
              Email harus diisi dengan format yang valid
            </div>
          </div>
          <div>
            <label
              for="registerPassword"
              class="block text-sm font-semibold text-gray-700 mb-2"
            >
              Kata Sandi
            </label>
            <input
              type="password"
              id="registerPassword"
              required
              class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent form-input"
              placeholder="Buat kata sandi (minimal 6 karakter)"
            />
            <div class="error-message" id="registerPasswordError">
              Kata sandi minimal 6 karakter
            </div>
          </div>

          <div class="flex gap-3 pt-4">
            <button
              type="button"
              id="cancelRegister"
              class="flex-1 py-3 bg-gray-200 text-gray-800 rounded-xl font-semibold hover:bg-gray-300 transition-all"
            >
              Batal
            </button>
            <button
              type="submit"
              class="flex-1 py-3 btn-primary rounded-xl font-semibold transition-all"
            >
              Daftar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Odontogram Modal -->
    <div id="odontogramModal" class="tooth-modal hidden">
      <div
        class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-gray-800">
            Pilih Kondisi Gigi <span id="selectedToothNumber"></span>
          </h3>
          <button
            type="button"
            id="closeOdontogramModal"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        <div class="space-y-2" id="conditionOptions">
          <!-- Condition options will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <!-- Modal Pesan Sukses (tersembunyi) -->
    <div
      id="success-modal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
    >
      <div
        class="bg-white p-8 rounded-lg shadow-xl text-center max-w-sm w-full"
      >
        <!-- Ikon Centang (SVG) -->
        <svg
          class="w-16 h-16 text-green-500 mx-auto mb-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
          ></path>
        </svg>
        <h2 class="text-2xl font-bold text-gray-800 mb-3">Tersimpan!</h2>
        <p class="text-gray-600 mb-6">
          Formulir Informed Consent telah berhasil disimpan.
        </p>
        <button
          id="close-modal"
          class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-300"
        >
          Tutup
        </button>
      </div>
    </div>

    <!-- Modal Data Pasien Lengkap -->
    <div id="patientDataModal" class="patient-data-modal hidden">
      <div class="patient-data-content">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Data Pasien Lengkap</h2>
          <div class="flex gap-2">
            <button
              id="printPatientData"
              class="btn-secondary px-4 py-2 rounded-xl text-sm"
            >
              <i class="fas fa-print mr-2"></i>Cetak PDF
            </button>
            <button
              id="exportPatientData"
              class="btn-primary px-4 py-2 rounded-xl text-sm"
            >
              <i class="fas fa-file-export mr-2"></i>Ekspor XLSX
            </button>
            <button
              id="closePatientData"
              class="bg-gray-500 text-white px-4 py-2 rounded-xl text-sm hover:bg-gray-600"
            >
              <i class="fas fa-times mr-2"></i>Tutup
            </button>
          </div>
        </div>
        <div id="patientDataContent">
          <!-- Data pasien akan diisi oleh JavaScript -->
        </div>
      </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
      <!-- Header -->
      <header
        class="bg-white/95 backdrop-blur-md border-b border-blue-100 sticky top-0 z-40 shadow-sm"
      >
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center py-4">
            <div class="flex items-center space-x-4">
              <!-- Logo Poltekes - DIPERBESAR -->
              <div class="w-20 h-20 rounded-xl overflow-hidden">
                <img 
                  src="https://i.ibb.co.com/BV4JnSRt/logo-baru-poltekes-bandung-removebg-preview.png" 
                  alt="Logo Poltekes Bandung" 
                  class="w-full h-full object-contain"
                >
              </div>
              <div>
                <h1
                  class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-cyan-500 bg-clip-text text-transparent"
                >
                  Kartu Status Askesgilut
                </h1>
                <p class="text-sm text-gray-500">
                  JKG | Politeknik Kesehatan Kemenkes Bandung
                </p>
              </div>
            </div>

            <div class="flex items-center space-x-4">
              <div
                class="hidden md:flex items-center space-x-2 text-sm text-gray-600"
              >
                <i class="fas fa-user-md medical-icon"></i>
                <span id="currentOperator">Operator</span>
                <span
                  id="currentNIM"
                  class="text-xs bg-gray-100 px-2 py-1 rounded"
                  >NIM: -</span
                >
              </div>
              <button
                type="button"
                id="logoutBtn"
                class="btn-primary px-6 py-2 rounded-xl text-sm font-semibold"
              >
                <i class="fas fa-sign-out-alt mr-2"></i>
                Keluar
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Navigation -->
      <nav class="bg-white/80 backdrop-blur-sm border-b border-blue-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex space-x-1 overflow-x-auto py-3">
            <button
              type="button"
              data-view="form"
              class="nav-btn flex items-center space-x-2 px-6 py-3 rounded-xl font-medium transition-all duration-300 nav-active"
            >
              <i class="fas fa-edit"></i>
              <span>Rekam Medis</span>
            </button>
            <button
              type="button"
              data-view="data"
              class="nav-btn flex items-center space-x-2 px-6 py-3 rounded-xl font-medium transition-all duration-300"
            >
              <i class="fas fa-table"></i>
              <span>Data Pasien</span>
            </button>
            <button
              type="button"
              data-view="dashboard"
              class="nav-btn flex items-center space-x-2 px-6 py-3 rounded-xl font-medium transition-all duration-300"
            >
              <i class="fas fa-chart-bar"></i>
              <span>Dashboard</span>
            </button>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Form View -->
        <div id="formView" class="view-section">
          <div class="section-card p-8">
            <!-- Operator Info -->
            <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-100">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label class="form-label">Nama Operator</label>
                  <input
                    type="text"
                    id="operatorNameField"
                    class="form-input"
                    value=""
                    readonly
                  />
                </div>
                <div>
                  <label class="form-label">NIM</label>
                  <input
                    type="text"
                    id="operatorNIMField"
                    class="form-input"
                    value=""
                    readonly
                  />
                </div>
                <div>
                  <label class="form-label">ID Klien</label>
                  <input
                    type="text"
                    id="clientIDField"
                    class="form-input"
                    value="KL001"
                    readonly
                  />
                </div>
              </div>
            </div>

            <h2 class="text-2xl font-bold text-gray-800 mb-2">
              Formulir Rekam Medis Gigi
            </h2>
            <p class="text-gray-600 mb-6">
              Isi data pasien dengan lengkap dan akurat
            </p>

            <!-- Form Sections Navigation -->
            <div class="mb-8">
              <div class="flex overflow-x-auto gap-2 pb-4">
                <button
                  type="button"
                  data-section="0"
                  class="section-tab flex items-center space-x-2 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-blue-500 text-white"
                >
                  <i class="fas fa-user"></i>
                  <span>Data Demografi</span>
                </button>
                <button
                  type="button"
                  data-section="1"
                  class="section-tab flex items-center space-x-2 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-200 text-gray-700"
                >
                  <i class="fas fa-heartbeat"></i>
                  <span>Riwayat Kesehatan</span>
                </button>
                <button
                  type="button"
                  data-section="2"
                  class="section-tab flex items-center space-x-2 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-200 text-gray-700"
                >
                  <i class="fas fa-tooth"></i>
                  <span>Riwayat Gigi</span>
                </button>
                <button
                  type="button"
                  data-section="3"
                  class="section-tab flex items-center space-x-2 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-200 text-gray-700"
                >
                  <i class="fas fa-brush"></i>
                  <span>Kebersihan Mulut</span>
                </button>
                <button
                  type="button"
                  data-section="4"
                  class="section-tab flex items-center space-x-2 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-200 text-gray-700"
                >
                  <i class="fas fa-utensils"></i>
                  <span>Kebiasaan Makan</span>
                </button>
                <button
                  type="button"
                  data-section="5"
                  class="section-tab flex items-center space-x-2 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-200 text-gray-700"
                >
                  <i class="fas fa-stethoscope"></i>
                  <span>Pemeriksaan Klinis</span>
                </button>
                <button
                  type="button"
                  data-section="6"
                  class="section-tab flex items-center space-x-2 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-200 text-gray-700"
                >
                  <i class="fas fa-file-medical"></i>
                  <span>Soft Tissue & OHI-S</span>
                </button>
                <button
                  type="button"
                  data-section="7"
                  class="section-tab flex items-center space-x-2 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-200 text-gray-700"
                >
                  <i class="fas fa-file-signature"></i>
                  <span>Diagnosis</span>
                </button>
                <button
                  type="button"
                  data-section="8"
                  class="section-tab flex items-center space-x-2 px-4 py-3 rounded-xl font-medium transition-all duration-300 bg-gray-200 text-gray-700"
                >
                  <i class="fas fa-clipboard-check"></i>
                  <span>Informed Consent</span>
                </button>
              </div>
            </div>

            <!-- Form content -->
            <div id="medicalRecordForm">
              <!-- Form sections will be loaded here dynamically -->
            </div>

            <!-- Form Navigation -->
            <div class="form-navigation">
              <button
                type="button"
                id="prevSection"
                class="btn-secondary px-6 py-3 rounded-xl font-semibold hidden"
              >
                <i class="fas fa-arrow-left mr-2"></i>
                Sebelumnya
              </button>
              <div class="section-indicator">
                <div class="section-dot active"></div>
                <div class="section-dot"></div>
                <div class="section-dot"></div>
                <div class="section-dot"></div>
                <div class="section-dot"></div>
                <div class="section-dot"></div>
                <div class="section-dot"></div>
                <div class="section-dot"></div>
                <div class="section-dot"></div>
              </div>
              <button
                type="button"
                id="nextSection"
                class="btn-primary px-6 py-3 rounded-xl font-semibold"
              >
                Selanjutnya
                <i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Data View -->
        <div id="dataView" class="view-section hidden">
          <div class="section-card p-8">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-2xl font-bold text-gray-800">Data Pasien</h2>
              <div class="flex gap-4">
                <div class="relative">
                  <input
                    type="text"
                    id="searchPatient"
                    placeholder="Cari nama pasien..."
                    class="form-input pl-10"
                  />
                  <i
                    class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
                  ></i>
                </div>
                <button
                  type="button"
                  id="exportData"
                  class="btn-secondary px-4 py-2 rounded-xl text-sm"
                >
                  <i class="fas fa-file-export mr-2"></i>
                  Ekspor
                </button>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full border-collapse">
                <thead>
                  <tr class="bg-blue-50">
                    <th class="p-3 text-left font-semibold">ID Pasien</th>
                    <th class="p-3 text-left font-semibold">Nama</th>
                    <th class="p-3 text-left font-semibold">Umur</th>
                    <th class="p-3 text-left font-semibold">Tanggal</th>
                    <th class="p-3 text-left font-semibold">Operator</th>
                    <th class="p-3 text-left font-semibold">Aksi</th>
                  </tr>
                </thead>
                <tbody id="patientTableBody">
                  <!-- Data will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboardView" class="view-section hidden">
          <div class="section-card p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">
              Dashboard Statistik
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
              <div
                class="bg-gradient-to-r from-blue-500 to-cyan-500 text-white p-6 rounded-2xl"
              >
                <h3 class="text-lg font-semibold mb-2">Total Pasien</h3>
                <p class="text-3xl font-bold" id="totalPatients">0</p>
              </div>
              <div
                class="bg-gradient-to-r from-green-500 to-emerald-500 text-white p-6 rounded-2xl"
              >
                <h3 class="text-lg font-semibold mb-2">Kondisi Baik</h3>
                <p class="text-3xl font-bold" id="goodCondition">0%</p>
              </div>
              <div
                class="bg-gradient-to-r from-amber-500 to-orange-500 text-white p-6 rounded-2xl"
              >
                <h3 class="text-lg font-semibold mb-2">Perlu Perawatan</h3>
                <p class="text-3xl font-bold" id="needTreatment">0%</p>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="bg-white p-6 rounded-2xl border border-gray-200">
                <h3 class="text-lg font-semibold mb-4">
                  Distribusi Kondisi Gigi
                </h3>
                <canvas id="conditionChart" height="300"></canvas>
              </div>
              <div class="bg-white p-6 rounded-2xl border border-gray-200">
                <h3 class="text-lg font-semibold mb-4">Kebiasaan Pasien</h3>
                <canvas id="habitsChart" height="300"></canvas>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Floating Action Button -->
      <div class="floating-action">
        <button
          type="button"
          id="saveRecordBtn"
          class="btn-primary w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-white text-xl"
        >
          <i class="fas fa-save"></i>
        </button>
      </div>
    </div>

    <!-- JavaScript untuk aplikasi utama -->
    <script>
      // Inisialisasi Supabase - MENGGUNAKAN AUTH
      const supabaseUrl = 'https://hhlfvyllzmvuehsuppeh.supabase.co';
      const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhobGZ2eWxsem12dWVoc3VwcGVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3MTExOTAsImV4cCI6MjA3ODI4NzE5MH0.xCAto6MiHdqS_8Cu8Zzmo9Zjv4WaLopsuSsk1utcXHk';
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

      // Data aplikasi
      let currentSection = 0;
      let currentView = "form";
      let currentUser = null;
      let patientData = [];
      let formData = {
        demographic: {},
        medicalHistory: {},
        dentalHistory: {},
        oralHygiene: {},
        dietaryHabits: {},
        clinicalExamination: {},
        softTissue: {},
        diagnosis: {},
        informedConsent: {},
      };

      // Inisialisasi aplikasi
      document.addEventListener("DOMContentLoaded", function () {
        // Setup event listeners
        setupEventListeners();
        // Check authentication state
        checkAuthState();
      });

      // Check authentication state
      async function checkAuthState() {
        const { data: { session }, error } = await supabase.auth.getSession();
        
        if (session && session.user) {
          // User sudah login
          currentUser = session.user;
          showMainApp();
          await loadUserProfile();
          
          // Load form sections
          loadFormSection(currentSection);
        }
      }

      // Load user profile dari tabel profiles
      async function loadUserProfile() {
        if (!currentUser) return;

        try {
          const { data: profile, error } = await supabase
            .from('profiles')
            .select('*')
            .eq('id', currentUser.id)
            .single();

          if (error) {
            console.error('Error loading profile:', error);
            return;
          }

          if (profile) {
            // Update info operator di UI
            document.getElementById("currentOperator").textContent =
              profile.full_name || currentUser.email;
            document.getElementById("currentNIM").textContent = 
              `NIM: ${profile.nim || '-'}`;
            document.getElementById("operatorNameField").value = 
              profile.full_name || currentUser.email;
            document.getElementById("operatorNIMField").value = 
              profile.nim || '-';
          }
        } catch (error) {
          console.error('Error loading profile:', error);
        }
      }

      // Setup semua event listeners
      function setupEventListeners() {
        // Login form
        document
          .getElementById("loginForm")
          .addEventListener("submit", handleLogin);
        document
          .getElementById("showRegister")
          .addEventListener("click", showRegisterModal);
        document
          .getElementById("cancelRegister")
          .addEventListener("click", hideRegisterModal);
        document
          .getElementById("registerForm")
          .addEventListener("submit", handleRegister);
        document
          .getElementById("toggleLoginPassword")
          .addEventListener("click", togglePasswordVisibility);

        // Navigation
        document.querySelectorAll(".nav-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            switchView(this.dataset.view);
          });
        });

        // Section navigation
        document.querySelectorAll(".section-tab").forEach((tab) => {
          tab.addEventListener("click", function () {
            const sectionIndex = parseInt(this.dataset.section);
            navigateToSection(sectionIndex);
          });
        });

        // Form navigation
        document
          .getElementById("prevSection")
          .addEventListener("click", goToPrevSection);
        document
          .getElementById("nextSection")
          .addEventListener("click", goToNextSection);

        // Save record
        document
          .getElementById("saveRecordBtn")
          .addEventListener("click", saveMedicalRecord);

        // Logout
        document
          .getElementById("logoutBtn")
          .addEventListener("click", handleLogout);

        // Close modals
        document
          .getElementById("closeOdontogramModal")
          .addEventListener("click", closeOdontogramModal);
        document
          .getElementById("close-modal")
          .addEventListener("click", function () {
            document.getElementById("success-modal").classList.add("hidden");
          });

        // Search patient
        document
          .getElementById("searchPatient")
          .addEventListener("input", searchPatient);

        // Export data
        document
          .getElementById("exportData")
          .addEventListener("click", exportPatientData);

        // Patient data modal
        document
          .getElementById("closePatientData")
          .addEventListener("click", function () {
            document.getElementById("patientDataModal").classList.add("hidden");
          });

        document
          .getElementById("printPatientData")
          .addEventListener("click", printPatientData);
        document
          .getElementById("exportPatientData")
          .addEventListener("click", exportSinglePatientData);
      }

      // Handle login dengan SUPABASE AUTH
      async function handleLogin(e) {
        e.preventDefault();
        console.log('Login attempt...');

        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        if (!validateEmail(email)) {
          showError("loginEmailError", "Email harus diisi dengan format yang valid");
          return;
        }

        if (!password) {
          showError("loginPasswordError", "Kata sandi harus diisi");
          return;
        }

        try {
          console.log('Signing in with Supabase Auth...');
          
          const { data, error } = await supabase.auth.signInWithPassword({
            email: email,
            password: password
          });

          console.log('Login response:', { data, error });

          if (error) {
            alert('‚ùå Login gagal: ' + error.message);
            return;
          }

          if (data.user) {
            currentUser = data.user;
            alert('‚úÖ Login berhasil!');
            showMainApp();
            await loadUserProfile();
            
            // Load form sections
            loadFormSection(currentSection);
          }

        } catch (error) {
          console.error('Login error:', error);
          alert('Terjadi kesalahan saat login: ' + error.message);
        }
      }

      // Handle register dengan SUPABASE AUTH + PROFILES
      async function handleRegister(e) {
        e.preventDefault();
        console.log('Registration started...');

        const name = document.getElementById("registerName").value;
        const nim = document.getElementById("registerNIM").value;
        const email = document.getElementById("registerEmail").value;
        const password = document.getElementById("registerPassword").value;

        // Validasi
        if (!name || !nim || !email || !password) {
          alert('Harap isi semua field!');
          return;
        }

        if (!validateEmail(email)) {
          alert('Format email tidak valid!');
          return;
        }

        if (password.length < 6) {
          alert('Password minimal 6 karakter!');
          return;
        }

        try {
          console.log('Creating user with Supabase Auth...');
          
          // 1. Daftar user di Supabase Auth
          const { data: authData, error: authError } = await supabase.auth.signUp({
            email: email,
            password: password,
            options: {
              data: {
                full_name: name,
                nim: nim
              }
            }
          });

          console.log('Auth signup response:', { authData, authError });

          if (authError) {
            if (authError.message.includes('already registered')) {
              alert('‚ùå Email sudah terdaftar!');
            } else {
              alert('Error: ' + authError.message);
            }
            return;
          }

          if (authData.user) {
            // 2. Trigger akan otomatis membuat profile
            alert('üéâ Pendaftaran berhasil! Silakan login.');
            hideRegisterModal();
            
            // Auto-fill login form
            document.getElementById("loginEmail").value = email;
            document.getElementById("loginPassword").value = password;
          }

        } catch (error) {
          console.error('Register catch error:', error);
          alert('Terjadi kesalahan: ' + error.message);
        }
      }

      // Logout function
      async function handleLogout() {
        const { error } = await supabase.auth.signOut();
        if (error) {
          alert('Error logging out: ' + error.message);
        } else {
          currentUser = null;
          showLoginScreen();
        }
      }

      // Show/hide screens
      function showMainApp() {
        document.getElementById("loginScreen").classList.add("hidden");
        document.getElementById("mainApp").classList.remove("hidden");
      }

      function showLoginScreen() {
        document.getElementById("loginScreen").classList.remove("hidden");
        document.getElementById("mainApp").classList.add("hidden");
      }

      // Toggle password visibility
      function togglePasswordVisibility() {
        const passwordInput = document.getElementById("loginPassword");
        const toggleButton = document.getElementById("toggleLoginPassword");

        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
        } else {
          passwordInput.type = "password";
          toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
        }
      }

      // Show register modal
      function showRegisterModal() {
        document.getElementById("registerModal").classList.remove("hidden");
      }

      // Hide register modal
      function hideRegisterModal() {
        document.getElementById("registerModal").classList.add("hidden");
      }

      // Switch between views
      function switchView(view) {
        // Update active nav button
        document.querySelectorAll(".nav-btn").forEach((btn) => {
          btn.classList.remove("nav-active");
          if (btn.dataset.view === view) {
            btn.classList.add("nav-active");
          }
        });

        // Hide all views
        document.querySelectorAll(".view-section").forEach((section) => {
          section.classList.add("hidden");
        });

        // Show selected view
        document.getElementById(`${view}View`).classList.remove("hidden");
        currentView = view;

        // Load data if needed
        if (view === "data") {
          loadPatientData();
        } else if (view === "dashboard") {
          loadDashboardData();
        }
      }

      // Navigate to form section
      function navigateToSection(sectionIndex) {
        // Update active tab
        document.querySelectorAll(".section-tab").forEach((tab, index) => {
          if (index === sectionIndex) {
            tab.classList.remove("bg-gray-200", "text-gray-700");
            tab.classList.add("bg-blue-500", "text-white");
          } else {
            tab.classList.remove("bg-blue-500", "text-white");
            tab.classList.add("bg-gray-200", "text-gray-700");
          }
        });

        // Update section indicator
        document.querySelectorAll(".section-dot").forEach((dot, index) => {
          if (index === sectionIndex) {
            dot.classList.add("active");
          } else {
            dot.classList.remove("active");
          }
        });

        // Update navigation buttons
        document
          .getElementById("prevSection")
          .classList.toggle("hidden", sectionIndex === 0);
        document
          .getElementById("nextSection")
          .classList.toggle("hidden", sectionIndex === 8);

        // Load section content
        loadFormSection(sectionIndex);
        currentSection = sectionIndex;
      }

      // Go to previous section
      function goToPrevSection() {
        if (currentSection > 0) {
          navigateToSection(currentSection - 1);
        }
      }

      // Go to next section
      function goToNextSection() {
        if (currentSection < 8) {
          // Validasi section saat ini sebelum pindah
          if (validateCurrentSection()) {
            navigateToSection(currentSection + 1);
          } else {
            alert(
              "Harap lengkapi semua field yang wajib diisi sebelum melanjutkan."
            );
          }
        }
      }

      // Validasi section saat ini
      function validateCurrentSection() {
        const currentForm = document.getElementById("medicalRecordForm");
        const requiredFields = currentForm.querySelectorAll("[required]");

        for (let field of requiredFields) {
          if (!field.value.trim()) {
            field.focus();
            return false;
          }
        }

        return true;
      }

      // Load form section content
      function loadFormSection(sectionIndex) {
        const formContainer = document.getElementById("medicalRecordForm");

        // Clear previous content
        formContainer.innerHTML = "";

        // Load section based on index
        switch (sectionIndex) {
          case 0:
            loadDemographicSection(formContainer);
            break;
          case 1:
            loadMedicalHistorySection(formContainer);
            break;
          case 2:
            loadDentalHistorySection(formContainer);
            break;
          case 3:
            loadOralHygieneSection(formContainer);
            break;
          case 4:
            loadDietaryHabitsSection(formContainer);
            break;
          case 5:
            loadClinicalExaminationSection(formContainer);
            break;
          case 6:
            loadSoftTissueSection(formContainer);
            break;
          case 7:
            loadDiagnosisSection(formContainer);
            break;
          case 8:
            loadInformedConsentSection(formContainer);
            break;
        }
      }

      // Load demographic section
      function loadDemographicSection(container) {
        container.innerHTML = `
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Data Demografi Pasien</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="form-label">Nama Lengkap <span class="text-red-500">*</span></label>
                        <input type="text" class="form-input" id="demographic-nama" placeholder="Masukkan nama lengkap pasien" required>
                    </div>
                    <div>
                        <label class="form-label">Jenis Kelamin <span class="text-red-500">*</span></label>
                        <select class="form-input" id="demographic-jenis-kelamin" required>
                            <option value="">Pilih jenis kelamin</option>
                            <option value="L">Laki-laki</option>
                            <option value="P">Perempuan</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Umur (Tahun) <span class="text-red-500">*</span></label>
                        <input type="number" class="form-input" id="demographic-umur" placeholder="Masukkan umur" required>
                    </div>
                    <div>
                        <label class="form-label">Agama <span class="text-red-500">*</span></label>
                        <select class="form-input" id="demographic-agama" required>
                            <option value="">Pilih agama</option>
                            <option value="Islam">Islam</option>
                            <option value="Kristen">Kristen</option>
                            <option value="Katolik">Katolik</option>
                            <option value="Hindu">Hindu</option>
                            <option value="Buddha">Buddha</option>
                            <option value="Konghucu">Konghucu</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Tanggal Lahir <span class="text-red-500">*</span></label>
                        <input type="date" class="form-input" id="demographic-tanggal-lahir" required>
                    </div>
                    <div>
                        <label class="form-label">Tempat Lahir <span class="text-red-500">*</span></label>
                        <input type="text" class="form-input" id="demographic-tempat-lahir" placeholder="Masukkan tempat lahir" required>
                    </div>
                    <div>
                        <label class="form-label">Pekerjaan <span class="text-red-500">*</span></label>
                        <input type="text" class="form-input" id="demographic-pekerjaan" placeholder="Masukkan pekerjaan" required>
                    </div>
                    <div>
                        <label class="form-label">Bangsa <span class="text-red-500">*</span></label>
                        <input type="text" class="form-input" id="demographic-bangsa" value="Indonesia" required>
                    </div>
                    <div class="md:col-span-2">
                        <label class="form-label">Alamat <span class="text-red-500">*</span></label>
                        <textarea class="form-input" id="demographic-alamat" rows="3" placeholder="Masukkan alamat lengkap" required></textarea>
                    </div>
                    <div>
                        <label class="form-label">Golongan Darah <span class="text-red-500">*</span></label>
                        <select class="form-input" id="demographic-golongan-darah" required>
                            <option value="">Pilih golongan darah</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="AB">AB</option>
                            <option value="O">O</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Status <span class="text-red-500">*</span></label>
                        <select class="form-input" id="demographic-status" required>
                            <option value="">Pilih status</option>
                            <option value="Belum Menikah">Belum Menikah</option>
                            <option value="Menikah">Menikah</option>
                            <option value="Cerai">Cerai</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">No. Telepon <span class="text-red-500">*</span></label>
                        <input type="tel" class="form-input" id="demographic-telepon" placeholder="Masukkan nomor telepon" required>
                    </div>
                    <div>
                        <label class="form-label">Tanggungan (Anak, Orang Lain) <span class="text-red-500">*</span></label>
                        <input type="text" class="form-input" id="demographic-tanggungan" placeholder="Masukkan tanggungan" required>
                    </div>
                    <div>
                        <label class="form-label">Suku/Adat <span class="text-red-500">*</span></label>
                        <input type="text" class="form-input" id="demographic-suku" placeholder="Masukkan suku/adat" required>
                    </div>
                    <div>
                        <label class="form-label">Berat Badan (Kg) <span class="text-red-500">*</span></label>
                        <input type="number" class="form-input" id="demographic-berat-badan" placeholder="Masukkan berat badan" required>
                    </div>
                    <div>
                        <label class="form-label">Tinggi Badan (cm) <span class="text-red-500">*</span></label>
                        <input type="number" class="form-input" id="demographic-tinggi-badan" placeholder="Masukkan tinggi badan" required>
                    </div>
                    <div>
                        <label class="form-label">Asuransi Kesehatan</label>
                        <input type="text" class="form-input" id="demographic-asuransi" placeholder="Masukkan asuransi kesehatan">
                    </div>
                    <div>
                        <label class="form-label">Sumber Rujukan</label>
                        <input type="text" class="form-input" id="demographic-rujukan" placeholder="Masukkan sumber rujukan">
                    </div>
                </div>
            `;
      }

      // Load medical history section
      function loadMedicalHistorySection(container) {
        container.innerHTML = `
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Riwayat Kesehatan Umum</h3>
                <div class="space-y-6">
                    <div>
                        <label class="form-label">Pasien merasa dalam keadaan sehat <span class="text-red-500">*</span></label>
                        <div class="flex gap-4 mt-2">
                            <label class="radio-label">
                                <input type="radio" name="kesehatanUmum" value="Ya" required> Ya
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="kesehatanUmum" value="Tidak" required> Tidak
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Selama 5 tahun terakhir, pasien pernah dinyatakan mengalami penyakit serius, menjalani operasi dan atau di rawat inap di rumah sakit</label>
                        <div class="flex gap-4 mt-2">
                            <label class="radio-label">
                                <input type="radio" name="penyakitSerius" value="Ya"> Ya
                            </label>
                        </div>
                        <div id="penyakitSeriusDetail" class="mt-2 hidden">
                            <textarea class="form-input" rows="2" placeholder="Jelaskan"></textarea>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Pasien mempunyai kelainan pembekuan darah</label>
                        <div class="flex gap-4 mt-2">
                            <label class="radio-label">
                                <input type="radio" name="kelainanPembekuanDarah" value="Ya"> Ya
                            </label>
                        </div>
                        <div id="kelainanPembekuanDetail" class="mt-2 hidden">
                            <textarea class="form-input" rows="3" placeholder="Jelaskan secara detail mengenai kelainan pembekuan darah"></textarea>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Pasien mempunyai reaksi alergi terhadap</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                            <label class="radio-label">
                                <input type="checkbox" name="alergiMakanan"> Makanan
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="alergiObat"> Obat-obatan
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="alergiSuntik"> Obat yang disuntik (obat bius)
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="alergiCuaca"> Cuaca dan lain-lain
                            </label>
                        </div>
                        <div id="alergiDetail" class="mt-2">
                            <textarea class="form-input" rows="2" placeholder="Lain-lain"></textarea>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Hasil Pemeriksaan Laboratorium</label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
                            <div>
                                <input type="text" class="form-input" placeholder="Trombosit, contoh: 240.000/ul">
                            </div>
                            <div>
                                <input type="text" class="form-input" placeholder="PT, contoh: 14 detik">
                            </div>
                            <div>
                                <input type="text" class="form-input" placeholder="APTT, contoh: 45 detik">
                            </div>
                        </div>
                    </div>
                </div>
            `;

        // Setup event listeners for conditional fields
        setupConditionalFields();
      }

      // Load dental history section
      function loadDentalHistorySection(container) {
        container.innerHTML = `
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Riwayat Kesehatan Gigi</h3>
                <div class="space-y-6">
                    <div>
                        <label class="form-label">Apa alasan utama kunjungan Anda ke klinik gigi? <span class="text-red-500">*</span></label>
                        <textarea class="form-input" rows="3" placeholder="Jelaskan alasan kunjungan" required></textarea>
                    </div>
                    <div>
                        <label class="form-label">Apakah yang ingin diketahui dari dalam rongga mulut Anda saat ini?</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                            <label class="radio-label">
                                <input type="checkbox" name="kerusakanGigi"> Kerusakan gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="penyakitGusi"> Penyakit pada gusi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="lukaJaringan"> Luka pada jaringan mulut
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="kankerMulut"> Kanker mulut
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Pernahkan dilakukan rontgen foto (x-ray) gigi/mulut dalam 2 tahun terakhir?</label>
                        <div class="flex gap-4 mt-2">
                            <label class="radio-label">
                                <input type="radio" name="rontgen" value="Ya"> Ya
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="rontgen" value="Tidak"> Tidak
                            </label>
                        </div>
                        <div id="rontgenType" class="mt-2 hidden">
                            <input type="text" class="form-input" placeholder="Jenis rontgen">
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Pernahkan Anda mengalami komplikasi atau pengalaman negatif yang terkait dengan perawatan gigi sebelumnya?</label>
                        <div class="flex gap-4 mt-2">
                            <label class="radio-label">
                                <input type="radio" name="komplikasi" value="Ya"> Ya
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="komplikasi" value="Tidak"> Tidak
                            </label>
                        </div>
                        <div id="komplikasiDetail" class="mt-2 hidden">
                            <textarea class="form-input" rows="2" placeholder="Jelaskan komplikasi"></textarea>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Bagaimana pendapat Anda tentang kunjungan ke klinik gigi sebelumnya?</label>
                        <select class="form-input">
                            <option value="">Pilih pendapat</option>
                            <option value="Sangat cemas/takut">Sangat cemas/takut</option>
                            <option value="Agak cemas/takut">Agak cemas/takut</option>
                            <option value="Tidak penting sama sekali">Tidak penting sama sekali</option>
                            <option value="Antusias menantikan kunjungan berikutnya">Antusias menantikan kunjungan berikutnya</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Bagaimana pendapat Anda tentang pernyataan ini? "Kesehatan gigi dan mulut mempengaruhi kesehatan umum."</label>
                        <select class="form-input">
                            <option value="">Pilih pendapat</option>
                            <option value="Sangat Setuju">Sangat Setuju</option>
                            <option value="Setuju">Setuju</option>
                            <option value="Tidak Setuju">Tidak Setuju</option>
                            <option value="Sangat tidak setuju">Sangat tidak setuju</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Apakah Anda mengalami gejala berikut?</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                            <label class="radio-label">
                                <input type="checkbox" name="gigiSensitif"> Gigi Sensitif
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="sakitRahang"> Sakit pada rahang
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="sakitGigi"> Sakit gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="sakitGusi"> Sakit gusi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="gusiBerdarah"> Gusi Berdarah
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="sulitMengunyah"> Kesulitan mengunyah
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="tambalanLepas"> Tambalan lepas
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="mulutKering"> Mulut kering
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="bauMulut"> Bau mulut
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="sensasiTerbakar"> Sensasi terbakar
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="bengkak"> Bengkak
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="gusiMenurun"> Gusi menurun
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Apakah gigi Anda bergemeretak/bergesekan di siang hari atau malam hari?</label>
                        <div class="flex gap-4 mt-2">
                            <label class="radio-label">
                                <input type="radio" name="bruxism" value="Ya"> Ya
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="bruxism" value="Tidak"> Tidak
                            </label>
                        </div>
                        <div id="biteGuard" class="mt-2 hidden">
                            <label class="form-label">Jika ya, apakah Anda mengenakan pelindung gigitan (bite guard)?</label>
                            <div class="flex gap-4 mt-2">
                                <label class="radio-label">
                                    <input type="radio" name="biteGuard" value="Ya"> Ya
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="biteGuard" value="Tidak"> Tidak
                                </label>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Dalam dua tahun terakhir apakah Anda mencemaskan tentang aroma nafas / penampilan gigi / wajah Anda?</label>
                        <div class="flex gap-4 mt-2">
                            <label class="radio-label">
                                <input type="radio" name="kekhawatiranPenampilan" value="Ya"> Ya
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="kekhawatiranPenampilan" value="Tidak"> Tidak
                            </label>
                        </div>
                        <div id="masalahPenampilan" class="mt-2 hidden">
                            <label class="form-label">Jika ya, apa saja yang Anda anggap bermasalah?</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                                <label class="radio-label">
                                    <input type="checkbox" name="gigiMenguning"> Gigi menguning atau berubah warna
                                </label>
                                <label class="radio-label">
                                    <input type="checkbox" name="gigiRenggang"> Jarak antara gigi (renggang)
                                </label>
                                <label class="radio-label">
                                    <input type="checkbox" name="nodaGigi"> Noda pada permukaan gigi
                                </label>
                                <label class="radio-label">
                                    <input type="checkbox" name="masalahGusi"> Masalah gusi
                                </label>
                                <label class="radio-label">
                                    <input type="checkbox" name="gigiBerjejal"> Gigi berjejal / tidak beraturan
                                </label>
                                <label class="radio-label">
                                    <input type="checkbox" name="profilWajah"> Profil wajah
                                </label>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Pernahkan Anda mengalami cedera pada gigi, wajah, dan rahang Anda?</label>
                        <div class="flex gap-4 mt-2">
                            <label class="radio-label">
                                <input type="radio" name="cedera" value="Ya"> Ya
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="cedera" value="Tidak"> Tidak
                            </label>
                        </div>
                        <div id="cederaDetail" class="mt-2 hidden">
                            <textarea class="form-input" rows="2" placeholder="Jika Ya, jelaskan"></textarea>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Apakah Anda pernah mengalami/menggunakan hal-hal berikut ini?</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                            <label class="radio-label">
                                <input type="checkbox" name="karangGigi"> Karang gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="pencabutanGigi"> Pencabutan gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="gigiPalsu"> Gigi palsu
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="perawatanSaluranAkar"> Perawatan saluran akar gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="operasiGusi"> Operasi Gusi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="kawatGigi"> Kawat gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="terapiRadiasi"> Terapi radiasi pada kepala/leher
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="operasiRahang"> Operasi rahang
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="sakitLeherKepala"> Rasa sakit pada leher dan kepala
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="pendarahanBerkepanjangan"> Pendarahan yang berkepanjangan setelah perawatan gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="lainnya"> Lain-lain
                            </label>
                        </div>
                    </div>
                </div>
            `;

        // Setup event listeners for conditional fields
        setupConditionalFields();
      }

      // Load oral hygiene section
      function loadOralHygieneSection(container) {
        container.innerHTML = `
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Pemeliharaan Kesehatan Gigi dan Mulut</h3>
                <div class="space-y-6">
                    <div>
                        <label class="form-label">Beri tanda (‚àö) pada hal-hal berikut yang sering Anda gunakan di rumah:</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                            <label class="radio-label">
                                <input type="checkbox" name="sikatLunak"> Sikat gigi dengan bulu sikat lunak
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="sikatSedang"> Sikat gigi dengan bulu sikat sedang
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="sikatKeras"> Sikat gigi dengan bulu sikat keras
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="sikatKhusus"> Sikat gigi khusus
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="sikatElektrik"> Sikat gigi elektrik
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="karetPemijat"> Karet pemijat gusi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="sikatSela"> Sikat khusus sela-sela gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="alatIrigasi"> Alat irigasi mulut
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="tusukGigi"> Tusuk gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="benangGigi"> Benang gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="benangBertangkai"> Benang gigi bertangkai
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="obatKumur"> Obat kumur
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="perekatGigiPalsu"> Perekat gigi palsu
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="pembersihGigiPalsu"> Pembersih gigi palsu
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="permenPembersih"> Permen pembersih gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="airFluoride"> Air minum berfluoride
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="airFluorideHarian"> Air minum berfluoride yang digunakan setiap hari
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="airBotol"> Air dalam botol/kemasan
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="pastaFluor"> Pasta/gel fluor
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="pastaBerfluoride"> Pasta gigi berfluoride
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="fluorTetes"> Fluor tetes/tablet
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="lainnyaAlat"> Lain-lain
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Beri tanda (‚àö) pada keunggulan pasta gigi yang Anda gunakan:</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                            <label class="radio-label">
                                <input type="checkbox" name="berfluoride"> Berfluoride
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="gigiSensitif"> Perlindungan gigi sensitif
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="kontrolKarang"> Mengontrol karang gigi
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="bakingSoda"> Mengandung baking soda
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="aromaMint"> Beraroma mint
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="peroxida"> Mengandung peroxida
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="banyakManfaat"> Memiliki banyak manfaat
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Berapa lama waktu yang dibutuhkan untuk membersihkan gigi dan gusi Anda sendiri:</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                            <div>
                                <input type="text" class="form-input" placeholder="Menyikat gigi (menit)">
                            </div>
                            <div>
                                <input type="text" class="form-input" placeholder="Menggunakan benang gigi/flossing (menit)">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Berapa kali Anda menyikat gigi/membersihkan menggunakan benang gigi?</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                            <div>
                                <input type="text" class="form-input" placeholder="Menyikat gigi (kali per hari)">
                            </div>
                            <div>
                                <input type="text" class="form-input" placeholder="Menggunakan benang gigi (kali per minggu)">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Apakah Anda merasa kesulitan mengatur jedwal menyikat/membersihkan gigi dan mulut karena kesibukan Anda atau alasan lain? (Waktu ideal: pagi setelah sarapan dan malam sebelum tidur)</label>
                        <div class="flex gap-4 mt-2">
                            <label class="radio-label">
                                <input type="radio" name="kesulitanJadwal" value="Ya"> Ya
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="kesulitanJadwal" value="Tidak"> Tidak
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Apakah ada kondisi yang membuat Anda sulit membersihkan gigi?</label>
                        <div class="flex gap-4 mt-2">
                            <label class="radio-label">
                                <input type="radio" name="kesulitanMembersihkan" value="Ya"> Ya
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="kesulitanMembersihkan" value="Tidak"> Tidak
                            </label>
                        </div>
                        <div id="jenisKesulitan" class="mt-2 hidden">
                            <label class="form-label">Jika iya, apa saja yang sulit:</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                                <label class="radio-label">
                                    <input type="checkbox" name="memegangSikat"> Memegang sikat gigi
                                </label>
                                <label class="radio-label">
                                    <input type="checkbox" name="menggunakanBenang"> Menggunakan benang gigi
                                </label>
                                <label class="radio-label">
                                    <input type="checkbox" name="memegangLama"> Memegang sikat/benang untuk waktu yang lama
                                </label>
                                <label class="radio-label">
                                    <input type="checkbox" name="penglihatanBuruk"> Penglihatan yang buruk
                                </label>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Apakah Anda rutin memeriksa setiap bulan untuk mengetahui adanya kanker mulut?</label>
                        <div class="flex gap-4 mt-2">
                            <label class="radio-label">
                                <input type="radio" name="pemeriksaanKanker" value="Ya"> Ya
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="pemeriksaanKanker" value="Tidak"> Tidak
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Manakah kebiasaan yang sering Anda lakukan:</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                            <label class="radio-label">
                                <input type="checkbox" name="menggigitBendaKeras"> Menggigit benda keras
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="merokok"> Merokok
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="kebiasaanLain"> Kebiasaan lain
                            </label>
                        </div>
                        <div id="kebiasaanLainDetail" class="mt-2">
                            <textarea class="form-input" rows="2" placeholder="Jelaskan kebiasaan lain"></textarea>
                        </div>
                    </div>
                </div>
            `;

        // Setup event listeners for conditional fields
        setupConditionalFields();
      }

      // Load dietary habits section
      function loadDietaryHabitsSection(container) {
        container.innerHTML = `
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Kebiasaan Makanan Ringan</h3>
                <div class="space-y-6">
                    <div>
                        <label class="form-label">Silahkan beri tanda pada cemilan yang mengandung gula/karbohidrat sering Anda makan diantara waktu makan</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                            <label class="radio-label">
                                <input type="checkbox" name="permenMint"> Permen mint
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="minumanManis"> Minuman manis
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="minumanKaleng"> Minuman kaleng/botol
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="permenKaret"> Permen karet
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="obatSyrup"> Obat syrup
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="keripik"> Keripik
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="buahKering"> Buah kering
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="kerupuk"> Kerupuk
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" name="kueKering"> Kue kering
                            </label>
                            <label class="radio-label">
                                <input type="checkbox" id="lainnyaCemilanCheckbox"> Lain-lain
                            </label>
                        </div>
                        <div id="lainnyaCemilanDetail" class="mt-2 hidden">
                            <label class="form-label">Jelaskan cemilan lainnya:</label>
                            <textarea class="form-input" rows="2" placeholder="Masukkan jenis cemilan lainnya"></textarea>
                        </div>
                    </div>
                </div>
            `;

        // Setup event listener untuk checkbox "Lain-lain"
        document
          .getElementById("lainnyaCemilanCheckbox")
          .addEventListener("change", function () {
            const detailElement = document.getElementById(
              "lainnyaCemilanDetail"
            );
            if (this.checked) {
              detailElement.classList.remove("hidden");
            } else {
              detailElement.classList.add("hidden");
            }
          });
      }

      // Load clinical examination section
      function loadClinicalExaminationSection(container) {
        container.innerHTML = `
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Pemeriksaan Klinis</h3>
                <div class="space-y-6">
                    <div>
                        <h4 class="text-lg font-medium text-gray-700 mb-4">Pemeriksaan Jaringan Keras Gigi (Odontogram)</h4>
                        
                        <!-- Palet Alat -->
                        <div class="flex flex-wrap items-center justify-between gap-4 p-4 bg-white rounded-lg shadow mb-4">
                            <div id="tool-buttons-container" class="flex flex-wrap items-center gap-2">
                                <span class="font-semibold text-gray-700">Pilih Alat:</span>
                                <!-- Baris 1: Alat Dasar -->
                                <button data-tool="clear" class="tool-button active bg-white border border-gray-300 text-gray-700 px-2 py-1 text-sm rounded-md shadow-sm hover:bg-gray-50 transition-all">
                                    Clear
                                </button>
                                <button data-tool="caries" data-style="fill-red-500" class="tool-button bg-red-600 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-red-700 transition-all">
                                    Karies (C)
                                </button>
                                <button data-tool="filling" data-style="fill-blue-600" class="tool-button bg-blue-600 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-blue-700 transition-all">
                                    Composite (F)
                                </button>
                                <button data-tool="amalgam" data-style="fill-gray-500" class="tool-button bg-gray-500 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-gray-600 transition-all">
                                    Amalgam (A)
                                </button>
                                <button data-tool="sealant" data-style="fill-green-600" class="tool-button bg-green-600 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-green-700 transition-all">
                                    Sealant (S)
                                </button>
                                <button data-tool="fracture" data-style="fracture" class="tool-button bg-yellow-500 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-yellow-600 transition-all">
                                    Fracture (#)
                                </button>
                                <!-- Baris 2: Status Gigi -->
                                <button data-tool="missing" data-style="missing" class="tool-button bg-black text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-gray-800 transition-all">
                                    Hilang (M)
                                </button>
                                <button data-tool="extraction" data-style="extraction" class="tool-button bg-red-800 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-red-900 transition-all">
                                    Ekstraksi (X)
                                </button>
                                <button data-tool="rrx" data-style="rrx" class="tool-button bg-amber-700 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-amber-800 transition-all">
                                    Sisa Akar (RRX)
                                </button>
                                <button data-tool="nvt" data-style="nvt" class="tool-button bg-purple-600 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-purple-700 transition-all">
                                    Non-Vital (NVT)
                                </button>
                                <button data-tool="rct" data-style="rct" class="tool-button bg-cyan-600 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-cyan-700 transition-all">
                                    RCT
                                </button>
                                <button data-tool="non" data-style="non" class="tool-button bg-gray-400 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-gray-500 transition-all">
                                    NON
                                </button>
                                <button data-tool="une" data-style="une" class="tool-button bg-teal-600 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-teal-700 transition-all">
                                    UNE
                                </button>
                                <button data-tool="pre" data-style="pre" class="tool-button bg-teal-700 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-teal-800 transition-all">
                                    PRE
                                </button>
                                <button data-tool="ano" data-style="ano" class="tool-button bg-orange-600 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-orange-700 transition-all">
                                    ANO
                                </button>
                                <!-- Baris 3: Restorasi & Prostetik -->
                                <button data-tool="fmc" data-style="fmc" class="tool-button bg-slate-700 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-slate-800 transition-all">
                                    FMC
                                </button>
                                <button data-tool="fmc-rct" data-style="fmc-rct" class="tool-button bg-slate-800 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-slate-900 transition-all">
                                    FMC-RCT
                                </button>
                                <button data-tool="poc" data-style="poc" class="tool-button bg-sky-600 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-sky-700 transition-all">
                                    POC
                                </button>
                                <button data-tool="poc-rct" data-style="poc-rct" class="tool-button bg-sky-700 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-sky-800 transition-all">
                                    POC-RCT
                                </button>
                                <button data-tool="ipx-poc" data-style="ipx-poc" class="tool-button bg-indigo-600 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-indigo-700 transition-all">
                                    IPX
                                </button>
                                <button data-tool="meb" data-style="meb" class="tool-button bg-gray-700 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-gray-800 transition-all">
                                    MEB
                                </button>
                                <button data-tool="pob" data-style="pob" class="tool-button bg-blue-800 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-blue-900 transition-all">
                                    POB
                                </button>
                                <button data-tool="prd-fld" data-style="prd-fld" class="tool-button bg-pink-600 text-white px-2 py-1 text-sm rounded-md shadow-sm hover:bg-pink-700 transition-all">
                                    PRD/FLD
                                </button>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="text-right">
                                    <span class="text-sm text-gray-600">Alat Aktif:</span>
                                    <span id="current-tool-display" class="font-bold text-blue-600">Clear</span>
                                </div>
                                <button id="clear-all-button" class="text-sm text-blue-600 hover:text-blue-800 transition-all font-medium">
                                    Bersihkan Semua
                                </button>
                            </div>
                        </div>

                        <!-- Legenda Permukaan Gigi -->
                        <div class="mb-6 p-4 bg-white rounded-lg shadow">
                            <h2 class="text-lg font-semibold mb-3 text-gray-800">Legenda Permukaan Gigi</h2>
                            <div class="flex flex-col md:flex-row items-center gap-4">
                                <!-- Diagram Visual -->
                                <div class="relative w-24 h-24" aria-hidden="true">
                                    <svg viewBox="0 0 100 100" class="w-full h-full">
                                        <path d="M 0 0 L 100 0 L 70 30 L 30 30 Z" class="fill-gray-100 stroke-gray-600 stroke-2"></path>
                                        <path d="M 0 100 L 100 100 L 70 70 L 30 70 Z" class="fill-gray-100 stroke-gray-600 stroke-2"></path>
                                        <path d="M 0 0 L 30 30 L 30 70 L 0 100 Z" class="fill-gray-100 stroke-gray-600 stroke-2"></path>
                                        <path d="M 100 0 L 100 100 L 70 70 L 70 30 Z" class="fill-gray-100 stroke-gray-600 stroke-2"></path>
                                        <path d="M 30 30 L 70 30 L 70 70 L 30 70 Z" class="fill-gray-100 stroke-gray-600 stroke-2"></path>
                                    </svg>
                                    <span class="absolute top-2 left-1/2 -translate-x-1/2 font-bold text-blue-700">V</span>
                                    <span class="absolute bottom-2 left-1/2 -translate-x-1/2 font-bold text-blue-700">L</span>
                                    <span class="absolute left-2 top-1/2 -translate-y-1/2 font-bold text-blue-700">M</span>
                                    <span class="absolute right-2 top-1/2 -translate-y-1/2 font-bold text-blue-700">D</span>
                                    <span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 font-bold text-blue-700">O</span>
                                </div>
                                <!-- Daftar Definisi -->
                                <ul class="list-disc list-inside text-gray-700 space-y-1">
                                    <li><span class="font-semibold text-gray-900">V</span> = Vestibular / Bukal (Permukaan luar menghadap pipi)</li>
                                    <li><span class="font-semibold text-gray-900">L</span> = Lingual / Palatal (Permukaan dalam menghadap lidah/langit-langit)</li>
                                    <li><span class="font-semibold text-gray-900">M</span> = Mesial (Permukaan samping menghadap garis tengah)</li>
                                    <li><span class="font-semibold text-gray-900">D</span> = Distal (Permukaan samping menjauhi garis tengah)</li>
                                    <li><span class="font-semibold text-gray-900">O</span> = Occusal / Insisal (Permukaan atas untuk mengunyah)</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Keterangan Tambahan Baru -->
                        <div class="mb-6 p-4 bg-white rounded-lg shadow">
                            <h2 class="text-lg font-semibold mb-3 text-gray-800">Keterangan Simbol Tambahan (Referensi)</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-2 text-sm">
                                
                                <!-- Kolom 1 -->
                                <ul class="space-y-1 list-disc list-inside">
                                    <li><span class="font-bold text-gray-500">amf</span>: Tambalan Amalgam</li>
                                    <li><span class="font-bold text-blue-600">cof</span>: Tambalan Composite</li>
                                    <li><span class="font-bold text-green-600">fis</span>: Pit dan Fissure Sealant</li>
                                    <li><span class="font-bold text-purple-600">nvt</span>: Gigi non-vital</li>
                                    <li><span class="font-bold text-cyan-600">rct</span>: Perawatan Saluran Akar</li>
                                    <li><span class="font-bold text-gray-400">non</span>: Gigi tidak ada (tidak diketahui)</li>
                                    <li><span class="font-bold text-teal-600">une</span>: Un-Erupted</li>
                                    <li><span class="font-bold text-teal-700">pre</span>: Partial Erupt</li>
                                </ul>

                                <!-- Kolom 2 -->
                                <ul class="space-y-1 list-disc list-inside">
                                    <li><span class="font-bold">sou</span>: Normal / Baik</li>
                                    <li><span class="font-bold text-orange-600">ano</span>: Anomali (Pegshaped, micro, fusi, dll)</li>
                                    <li><span class="font-bold text-red-500">car</span>: Caries</li>
                                    <li><span class="font-bold text-yellow-500">cfr</span>: Fracture</li>
                                    <li><span class="font-bold text-slate-700">fmc</span>: Full metal crown (vital)</li>
                                    <li><span class="font-bold text-slate-800">fmc-rct</span>: Full metal crown (non-vital)</li>
                                    <li><span class="font-bold text-sky-600">poc</span>: Porcelain crown (vital)</li>
                                    <li><span class="font-bold text-sky-700">poc-rct</span>: Porcelain crown (non-vital)</li>
                                </ul>

                                <!-- Kolom 3 -->
                                <ul class="space-y-1 list-disc list-inside">
                                    <li><span class="font-bold text-amber-700">rrx</span>: Sisa Akar</li>
                                    <li><span class="font-bold text-black">mis</span>: Gigi hilang</li>
                                    <li><span class="font-bold text-indigo-600">ipx-poc</span>: Implant + Porcelain crown</li>
                                    <li><span class="font-bold text-gray-700">meb</span>: Full metal bridge</li>
                                    <li><span class="font-bold text-blue-800">pob</span>: Porcelain bridge</li>
                                    <li><span class="font-bold text-pink-600">PRD/FLD</span>: Partial/Full Denture</li>
                                    <li><span class="font-bold">Migrasi</span>: Panah sesuai arah</li>
                                </ul>
                            </div>
                            <p class="mt-4 text-xs text-gray-600">Catatan: Keterangan ini adalah referensi. Alat interaktif di atas (Karies, Tumpatan, dll) adalah fungsi dasar dan mungkin berbeda dari simbol-simbol lengkap ini.</p>
                        </div>

                        <!-- Kontainer Odontogram -->
                        <div id="odontogram-container" class="p-4 bg-white rounded-lg shadow overflow-x-auto">
                            <div class="flex flex-col gap-2 min-w-[1000px]">
                                
                                <!-- Baris 1: Gigi Dewasa Atas (18-11, 21-28) -->
                                <div id="row-1" class="flex justify-center items-end h-20"></div>
                                
                                <!-- Baris 2: Gigi Susu Atas (55-51, 61-65) -->
                                <div id="row-2" class="flex justify-center items-start h-20"></div>

                                <!-- Garis Tengah -->
                                <hr class="border-gray-300 border-t-2 my-2">

                                <!-- Baris 3: Gigi Susu Bawah (85-81, 71-75) -->
                                <div id="row-3" class="flex justify-center items-end h-20"></div>

                                <!-- Baris 4: Gigi Dewasa Bawah (48-41, 31-38) -->
                                <div id="row-4" class="flex justify-center items-start h-20"></div>

                            </div>
                        </div>

                        <!-- Tabel Keterangan Gigi -->
                        <div class="mt-6 p-4 bg-white rounded-lg shadow">
                            <div class="flex flex-col md:flex-row justify-between md:items-center mb-4 gap-4">
                                <h2 class="text-lg font-semibold text-gray-800 shrink-0">c. Pemeriksaan Jaringan Keras Gigi</h2>
                                <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto items-center">
                                    <!-- Tombol Simpan/Muat dan Status -->
                                    <div class="flex items-center gap-2">
                                        <label for="client-id" class="text-sm font-medium shrink-0">No. ID Klien:</label>
                                        <input type="text" id="client-id" class="w-full border-b-2 border-gray-300 focus:border-blue-500 outline-none px-2 py-1 text-sm">
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="fill-date" class="text-sm font-medium shrink-0">Tgl Pengisian:</label>
                                        <input type="text" id="fill-date" class="w-full border-b-2 border-gray-300 focus:border-blue-500 outline-none px-2 py-1 text-sm">
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button id="save-button" class="px-3 py-1 bg-blue-600 text-white text-sm rounded-md shadow-sm hover:bg-blue-700 transition-all">Simpan</button>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button id="load-button" class="px-3 py-1 bg-gray-600 text-white text-sm rounded-md shadow-sm hover:bg-gray-700 transition-all">Muat</button>
                                    </div>
                                    <span id="save-status" class="text-sm text-gray-600 italic h-6"></span>
                                </div>
                            </div>

                            <!-- Wrapper Tabel -->
                            <div class="text-sm">
                                
                                <!-- Rahang Atas -->
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-x-4 border-b-2 border-gray-300 pb-2 mb-2">
                                    <!-- Kolom 1: Kiri (11-18) -->
                                    <div class="flex flex-col gap-1 col-span-1">
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">11 [51]</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">12 [52]</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">13 [53]</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">14 [54]</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">15 [55]</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">16</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">17</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">18</span>
                                        </div>
                                    </div>

                                    <!-- Kolom 2: Input Kiri -->
                                    <div class="flex flex-col gap-1 col-span-1">
                                        <input type="text" class="status-input h-6" data-tooth="11" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="12" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="13" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="14" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="15" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="16" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="17" value="Une">
                                        <input type="text" class="status-input h-6" data-tooth="18" value="Une">
                                    </div>

                                    <!-- Kolom 3: Input Kanan -->
                                    <div class="flex flex-col gap-1 col-span-1">
                                        <input type="text" class="status-input h-6" data-tooth="21" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="22" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="23" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="24" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="25" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="26" value="une">
                                        <input type="text" class="status-input h-6" data-tooth="27" value="une">
                                        <input type="text" class="status-input h-6" data-tooth="28" value="une">
                                    </div>

                                    <!-- Kolom 4: Kanan (21-28) -->
                                    <div class="flex flex-col gap-1 col-span-1 text-right">
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">[61] 21</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">[62] 22</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">[63] 23</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">[64] 24</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">[65] 25</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">26</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">27</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">28</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Rahang Bawah -->
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-x-4 pt-2">
                                    <!-- Kolom 1: Kiri (41-48) -->
                                    <div class="flex flex-col gap-1 col-span-1">
                                         <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">48</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">47</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">46</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">45 [85]</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">44 [84]</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">43 [83]</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">42 [82]</span>
                                        </div>
                                        <div class="flex items-center h-6">
                                            <span class="w-12 font-bold shrink-0">41 [81]</span>
                                        </div>
                                    </div>

                                    <!-- Kolom 2: Input Kiri -->
                                    <div class="flex flex-col gap-1 col-span-1">
                                        <input type="text" class="status-input h-6" data-tooth="48" value="Une">
                                        <input type="text" class="status-input h-6" data-tooth="47" value="Une">
                                        <input type="text" class="status-input h-6" data-tooth="46" value="O Car KME">
                                        <input type="text" class="status-input h-6" data-tooth="45" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="44" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="43" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="42" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="41" value="Sou">
                                    </div>
                                    
                                    <!-- Kolom 3: Input Kanan -->
                                    <div class="flex flex-col gap-1 col-span-1">
                                        <input type="text" class="status-input h-6" data-tooth="38" value="une">
                                        <input type="text" class="status-input h-6" data-tooth="37" value="Une">
                                        <input type="text" class="status-input h-6" data-tooth="36" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="35" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="34" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="33" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="32" value="Sou">
                                        <input type="text" class="status-input h-6" data-tooth="31" value="Sou">
                                    </div>

                                    <!-- Kolom 4: Kanan (31-38) -->
                                    <div class="flex flex-col gap-1 col-span-1 text-right">
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">38</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">37</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">36</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">[75] 35</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">[74] 34</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">[73] 33</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">[72] 32</span>
                                        </div>
                                        <div class="flex items-center justify-end h-6">
                                            <span class="w-12 font-bold shrink-0">[71] 31</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

        // Initialize odontogram
        initializeOdontogram();
      }

      // Load soft tissue section
      function loadSoftTissueSection(container) {
        container.innerHTML = `
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Pemeriksaan Soft Tissue & OHI-S</h3>
                <div class="space-y-8">
                    <!-- Bagian 1: PEMERIKSAAN EXTRAORAL & INTRAORAL -->
                    <div class="overflow-x-auto">
                        <div class="grid gap-x-6" style="grid-template-columns: max-content auto auto;">
                            <!-- Header Kolom -->
                            <div class="font-bold text-sm"></div>
                            <div class="font-bold text-sm text-center">N</div>
                            <div class="font-bold text-sm text-center">O</div>

                            <!-- Items EXTRAORAL -->
                            <div class="font-bold text-sm uppercase col-span-3 pt-2 pb-1">EXTRAORAL</div>
                            <!-- Daftar item (contoh beberapa) -->
                            <div class="text-sm border-b py-1.5 pr-4">* Skin</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="skin" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="skin" value="o"></div>

                            <div class="text-sm border-b py-1.5 pr-4">* Face</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="face" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="face" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">* Neck</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="neck" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="neck" value="o"></div>

                            <div class="text-sm border-b py-1.5 pr-4">Vermilion Borders</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="vermilion" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="vermilion" value="o"></div>

                            <div class="text-sm border-b py-1.5 pr-4">* Parotid Glands</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="parotid" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="parotid" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">Lymph Nodes</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="lymph" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="lymph" value="o"></div>

                            <div class="text-sm border-b py-1.5 pl-4 pr-4">Anterior Cervical</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="ant_cervical" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="ant_cervical" value="o"></div>

                            <div class="text-sm border-b py-1.5 pl-4 pr-4">Posterior Cervical</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="post_cervical" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="post_cervical" value="o"></div>

                            <div class="text-sm border-b py-1.5 pl-4 pr-4">Submental</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="submental" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="submental" value="o"></div>

                            <div class="text-sm border-b py-1.5 pl-4 pr-4">Submandibular</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="submandibular" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="submandibular" value="o"></div>

                            <div class="text-sm border-b py-1.5 pl-4 pr-4">Supraclavicular</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="supraclavicular" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="supraclavicular" value="o"></div>

                            <!-- Items INTRAORAL -->
                            <div class="font-bold text-sm uppercase col-span-3 pt-4 pb-1">INTRAORAL</div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">Labial Vestibules</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="labial_v" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="labial_v" value="o"></div>

                            <div class="text-sm border-b py-1.5 pr-4">Labial Mucosa</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="labial_m" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="labial_m" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">Anterior Gingivae</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="ant_gingivae" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="ant_gingivae" value="o"></div>

                            <div class="text-sm border-b py-1.5 pr-4">Buccal Vestibules</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="buccal_v" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="buccal_v" value="o"></div>

                            <div class="text-sm border-b py-1.5 pr-4">Buccal Gingivae</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="buccal_g" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="buccal_g" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">* Tongue -- Dorsal</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="tongue_d" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="tongue_d" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">* Tongue -- Ventral</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="tongue_v" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="tongue_v" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">* Floor of Mouth</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="floor" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="floor" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">* Lingual Tonsils</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="lingual_t" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="lingual_t" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">Palatal Gingivae</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="palatal_g" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="palatal_g" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">Lingual Gingivae</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="lingual_g" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="lingual_g" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">Tonsillar Pillars</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="tonsillar" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="tonsillar" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">* Pharyngeal Wall</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="pharyngeal" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="pharyngeal" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">* Soft Palate</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="soft_p" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="soft_p" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">Uvula</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="uvula" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="uvula" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">Hard Palate</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="hard_p" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="hard_p" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">Buccal Gingivae</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="buccal_g2" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="buccal_g2" value="o"></div>
                            
                            <div class="text-sm border-b py-1.5 pr-4">Submandibular Glands</div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="submand_g" value="n"></div>
                            <div class="border-b py-1.5 flex justify-center"><input type="radio" name="submand_g" value="o"></div>
                        </div>
                    </div>
                    
                    <div class="text-xs mt-2">* High risk sites for squamous carcinoma</div>
                    <div class="mt-4">
                        <label for="catatan" class="font-semibold block mb-1">Catatan:</label>
                        <textarea id="catatan" rows="3" class="w-full border border-gray-300 rounded p-2"></textarea>
                    </div>

                    <!-- BAGIAN 2: PEMERIKSAAN ORAL HYGIENE -->
                    <div class="mt-8">
                        <h2 class="text-lg font-bold">5. Pemeriksaan Oral Hygiene</h2>
                        
                        <div class="ml-4 mt-2">
                            <h3 class="font-semibold">a. Pemeriksaan OHI-S (Sebelum menyikat gigi sendiri)</h3>
                            
                            <div class="flex flex-wrap gap-x-8 gap-y-4 mt-3 items-start">

                                <!-- Grup 1: Gigi Index -->
                                <div>
                                    <label class="text-sm font-medium block mb-1">Gigi Index</label>
                                    <div class="grid grid-cols-3 w-[96px]">
                                        <input type="text" class="ohis-input">
                                        <input type="text" class="ohis-input">
                                        <input type="text" class="ohis-input">
                                        <input type="text" class="ohis-input">
                                        <input type="text" class="ohis-input">
                                        <input type="text" class="ohis-input">
                                    </div>
                                </div>

                                <!-- Grup 2: Debris Index -->
                                <div>
                                    <label class="text-sm font-medium block mb-1">Debris Index</label>
                                    <div class="flex flex-col">
                                        <!-- Baris 1: 3 kotak -->
                                        <div class="flex">
                                            <input type="text" class="ohis-input ohis-debris">
                                            <input type="text" class="ohis-input ohis-debris">
                                            <input type="text" class="ohis-input ohis-debris">
                                        </div>
                                        <!-- Baris 2: 4 kotak -->
                                        <div class="flex">
                                            <input type="text" class="ohis-input ohis-debris">
                                            <input type="text" class="ohis-input ohis-debris">
                                            <input type="text" class="ohis-input ohis-debris">
                                            <input type="text" class="ohis-input ohis-debris">
                                        </div>
                                    </div>
                                    <p class="text-sm mt-1"><strong>Kriteria DI :</strong></p>
                                </div>

                                <!-- Grup 3: Calculus Index -->
                                <div>
                                    <label class="text-sm font-medium block mb-1">Calculus Index</label>
                                    <div class="flex flex-col">
                                        <!-- Baris 1: 3 kotak -->
                                        <div class="flex">
                                            <input type="text" class="ohis-input ohis-calculus">
                                            <input type="text" class="ohis-input ohis-calculus">
                                            <input type="text" class="ohis-input ohis-calculus">
                                        </div>
                                        <!-- Baris 2: 4 kotak -->
                                        <div class="flex">
                                            <input type="text" class="ohis-input ohis-calculus">
                                            <input type="text" class="ohis-input ohis-calculus">
                                            <input type="text" class="ohis-input ohis-calculus">
                                            <input type="text" class="ohis-input ohis-calculus">
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="mt-3 text-sm">
                                <p><strong>Kriteria OHI-S :</strong></p>
                                
                                <!-- HASIL PERHITUNGAN OHI-S -->
                                <div class="mt-2 p-3 bg-gray-50 border border-gray-200 rounded-lg">
                                    <h4 class="text-md font-bold">Hasil OHI-S:</h4>
                                    <div class="flex flex-wrap gap-x-6 gap-y-1 mt-1 text-base">
                                        <div>
                                            <span class="font-semibold">Debris Index (DI):</span>
                                            <span id="diResult" class="font-bold text-blue-600 ml-1">0.00</span>
                                        </div>
                                        <div>
                                            <span class="font-semibold">Calculus Index (CI):</span>
                                            <span id="ciResult" class="font-bold text-blue-600 ml-1">0.00</span>
                                        </div>
                                        <div>
                                            <span class="font-semibold">OHI-S (DI + CI):</span>
                                            <span id="ohisResult" class="font-bold text-red-600 ml-1">0.00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- BAGIAN 3: PEMERIKSAAN PLAK (PLAQUE CONTROL) -->
                        <div class="ml-4 mt-6">
                            <h3 class="font-semibold">b. Pemeriksaan Hasil Menyikat Gigi Sendiri (Plaque Control) Kunjungan I</h3>
                            
                            <div class="mt-4 overflow-x-auto">
                                <div class="inline-block min-w-full relative" style="padding-left: 2px; padding-right: 2px;">
                                    <!-- Garis Vertikal Pemisah -->
                                    <div class="vertical-divider" style="height: 100%;"></div>

                                    <!-- Baris 1: Angka 18-28 (Permanent Atas) -->
                                    <div class="flex justify-between">
                                        <div class="flex">
                                            <span class="tooth-number">18</span>
                                            <span class="tooth-number">17</span>
                                            <span class="tooth-number">16</span>
                                            <span class="tooth-number">15</span>
                                            <span class="tooth-number">14</span>
                                            <span class="tooth-number">13</span>
                                            <span class="tooth-number">12</span>
                                            <span class="tooth-number">11</span>
                                        </div>
                                        <div class="flex">
                                            <span class="tooth-number">21</span>
                                            <span class="tooth-number">22</span>
                                            <span class="tooth-number">23</span>
                                            <span class="tooth-number">24</span>
                                            <span class="tooth-number">25</span>
                                            <span class="tooth-number">26</span>
                                            <span class="tooth-number">27</span>
                                            <span class="tooth-number">28</span>
                                        </div>
                                    </div>

                                    <!-- Baris 2: Kotak 18-28 (Permanent Atas) -->
                                    <div class="flex justify-between">
                                        <div class="flex">
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                        </div>
                                        <div class="flex">
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Baris 3: Angka 55-65 (Deciduous Atas) -->
                                    <div class="flex justify-center mt-1">
                                        <div class="flex">
                                            <div style="width: 96px;"></div>
                                            <span class="tooth-number">55</span>
                                            <span class="tooth-number">54</span>
                                            <span class="tooth-number">53</span>
                                            <span class="tooth-number">52</span>
                                            <span class="tooth-number">51</span>
                                        </div>
                                        <div style="width: 64px;"></div>
                                        <div class="flex">
                                            <span class="tooth-number">61</span>
                                            <span class="tooth-number">62</span>
                                            <span class="tooth-number">63</span>
                                            <span class="tooth-number">64</span>
                                            <span class="tooth-number">65</span>
                                            <div style="width: 96px;"></div>
                                        </div>
                                    </div>

                                     <!-- Baris 4: Kotak 55-65 (Deciduous Atas) -->
                                     <div class="flex justify-center">
                                        <div class="flex">
                                            <div style="width: 96px;"></div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                        </div>
                                        <div style="width: 64px;"></div>
                                        <div class="flex">
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div style="width: 96px;"></div>
                                        </div>
                                    </div>

                                    <!-- Garis Pemisah Tebal -->
                                    <div class="thick-divider my-2"></div>

                                    <!-- Baris 5: Angka 85-75 (Deciduous Bawah) -->
                                    <div class="flex justify-center mb-1">
                                        <div class="flex">
                                            <div style="width: 96px;"></div>
                                            <span class="tooth-number">85</span>
                                            <span class="tooth-number">84</span>
                                            <span class="tooth-number">83</span>
                                            <span class="tooth-number">82</span>
                                            <span class="tooth-number">81</span>
                                        </div>
                                        <div style="width: 64px;"></div>
                                        <div class="flex">
                                            <span class="tooth-number">71</span>
                                            <span class="tooth-number">72</span>
                                            <span class="tooth-number">73</span>
                                            <span class="tooth-number">74</span>
                                            <span class="tooth-number">75</span>
                                            <div style="width: 96px;"></div>
                                        </div>
                                    </div>

                                     <!-- Baris 6: Kotak 85-75 (Deciduous Bawah) -->
                                     <div class="flex justify-center">
                                        <div class="flex">
                                            <div style="width: 96px;"></div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                        </div>
                                        <div style="width: 64px;"></div>
                                        <div class="flex">
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div style="width: 96px;"></div>
                                        </div>
                                    </div>

                                    <!-- Baris 7: Kotak 48-38 (Permanent Bawah) -->
                                    <div class="flex justify-between mt-1">
                                        <div class="flex">
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                        </div>
                                        <div class="flex">
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                            <div class="plaque-tooth">
                                                <div class="surface surface-f" data-surface="facial"></div><div class="surface surface-l" data-surface="lingual"></div><div class="surface surface-m" data-surface="mesial"></div><div class="surface surface-d" data-surface="distal"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Baris 8: Angka 48-38 (Permanent Bawah) -->
                                    <div class="flex justify-between mt-1">
                                        <div class="flex">
                                            <span class="tooth-number">48</span>
                                            <span class="tooth-number">47</span>
                                            <span class="tooth-number">46</span>
                                            <span class="tooth-number">45</span>
                                            <span class="tooth-number">44</span>
                                            <span class="tooth-number">43</span>
                                            <span class="tooth-number">42</span>
                                            <span class="tooth-number">41</span>
                                        </div>
                                        <div class="flex">
                                            <span class="tooth-number">31</span>
                                            <span class="tooth-number">32</span>
                                            <span class="tooth-number">33</span>
                                            <span class="tooth-number">34</span>
                                            <span class="tooth-number">35</span>
                                            <span class="tooth-number">36</span>
                                            <span class="tooth-number">37</span>
                                            <span class="tooth-number">38</span>
                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- BAGIAN 4: RUMUS KR -->
                    <div class="mt-8 flex flex-wrap items-end gap-x-6 gap-y-2 text-sm">
                        <div class="flex items-center">
                            <span class="text-lg font-bold">KR =</span>
                            <div class="inline-block text-center mx-2 text-sm">
                                <span class="block border-b-2 border-black pb-0.5 px-2">jl euk g d lk</span>
                                <span class="block pt-0.5 px-2">jl euk g deks</span>
                            </div>
                        </div>
                        <div class="flex items-end gap-2">
                            <span>1% =</span>
                            <input type="text" class="border-b border-gray-400 w-16 text-center">
                        </div>
                         <div class="flex items-end gap-2">
                            <span>‚Äî1% =</span>
                            <input type="text" class="border-b border-gray-400 w-16 text-center">
                        </div>
                         <div class="flex items-end gap-2">
                            <span>% =</span>
                            <input type="text" class="border-b border-gray-400 w-16 text-center">
                        </div>
                        <div class="font-semibold">
                            Kategori: &lt; 15% = Baik &nbsp;&nbsp; &ge;15% = Buruk
                        </div>

                        <!-- HASIL PERHITUNGAN OTOMATIS -->
                        <div class="flex items-end ml-4">
                            <span class="text-lg font-bold">Skor Plak:</span>
                            <span id="plaqueResult" class="text-lg font-bold text-blue-600 ml-2">0.00%</span>
                            <span id="plaqueResultCategory" class="text-lg font-semibold ml-2 text-green-600">(Baik)</span>
                        </div>
                    </div>

                    <!-- Tombol Reset -->
                    <div class="mt-6 text-center">
                        <button type="button" id="resetSoftTissue" class="btn-secondary px-6 py-3 rounded-xl font-semibold">
                            <i class="fas fa-redo mr-2"></i>
                            Reset Soft Tissue & OHI-S
                        </button>
                    </div>
                </div>
            `;

        // Setup OHI-S dan Plaque Control
        setupOhisAndPlaqueControl();

        // Setup tombol reset
        document
          .getElementById("resetSoftTissue")
          .addEventListener("click", function () {
            if (
              confirm(
                "Apakah Anda yakin ingin mereset semua data Soft Tissue & OHI-S?"
              )
            ) {
              // Reset semua input radio
              const radioInputs = container.querySelectorAll(
                'input[type="radio"]'
              );
              radioInputs.forEach((input) => {
                input.checked = false;
              });

              // Reset textarea
              const textareas = container.querySelectorAll("textarea");
              textareas.forEach((textarea) => {
                textarea.value = "";
              });

              // Reset OHI-S inputs
              const ohisInputs = container.querySelectorAll(".ohis-input");
              ohisInputs.forEach((input) => {
                input.value = "";
              });

              // Reset plaque surfaces
              const surfaces = container.querySelectorAll(".surface");
              surfaces.forEach((surface) => {
                surface.classList.remove("selected");
              });

              // Reset hasil perhitungan
              document.getElementById("diResult").textContent = "0.00";
              document.getElementById("ciResult").textContent = "0.00";
              document.getElementById("ohisResult").textContent = "0.00";
              document.getElementById("plaqueResult").textContent = "0.00%";
              document.getElementById("plaqueResultCategory").textContent =
                "(Baik)";
              document.getElementById("plaqueResultCategory").className =
                "text-lg font-semibold ml-2 text-green-600";

              alert("Data Soft Tissue & OHI-S telah direset.");
            }
          });
      }

      // Load diagnosis section
      function loadDiagnosisSection(container) {
        container.innerHTML = `
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Diagnosis, Perencanaan, Implementasi dan Evaluasi Askesgilut</h3>
                <div class="space-y-8">
                    <!-- Kontrol Simpan/Muat -->
                    <div class="mb-6 p-4 bg-white rounded-lg shadow">
                        <div class="flex flex-col md:flex-row flex-wrap gap-4 items-start md:items-center md:justify-end">
                            <!-- Grup untuk inputs -->
                            <div class="flex flex-col sm:flex-row gap-4">
                                <div class="flex items-center gap-2">
                                    <label for="client-id" class="text-sm font-medium shrink-0">No. ID Klien:</label>
                                    <input type="text" id="client-id" class="w-full sm:w-auto border-b-2 border-gray-300 focus:border-blue-500 outline-none px-2 py-1 text-sm">
                                </div>
                                <div class="flex items-center gap-2">
                                    <label for="fill-date" class="text-sm font-medium shrink-0">Tgl Pengisian:</label>
                                    <input type="text" id="fill-date" class="w-full sm:w-auto border-b-2 border-gray-300 focus:border-blue-500 outline-none px-2 py-1 text-sm">
                                </div>
                            </div>
                            
                            <!-- Grup untuk buttons dan status -->
                            <div class="flex items-center gap-2">
                                <button id="save-button" class="px-3 py-1 bg-blue-600 text-white text-sm rounded-md shadow-sm hover:bg-blue-700 transition-all">Simpan</button>
                                <button id="load-button" class="px-3 py-1 bg-gray-600 text-white text-sm rounded-md shadow-sm hover:bg-gray-700 transition-all">Muat</button>
                                <span id="save-status" class="text-sm text-gray-600 italic h-6 ml-2"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Bagian Askesgilut -->
                    <div class="mt-6 p-4 bg-white rounded-lg shadow">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Diagnosis, Perencanaan, Implementasi dan Evaluasi Askesgilut</h2>

                        <!-- 8 Kebutuhan Khusus (Tabel) -->
                        <div class="mb-4">
                            <h3 class="text-md font-semibold mb-2 text-gray-700">8 Kebutuhan Khusus</h3>
                            <div class="border border-gray-300 rounded-md overflow-hidden">
                                <table class="w-full divide-y divide-gray-300">
                                    <tbody class="divide-y divide-gray-300">
                                        <!-- Baris 1 -->
                                        <tr class="divide-x divide-gray-300">
                                            <td class="p-3 w-1/2 align-top">
                                                <label for="kebutuhan-1" class="block text-sm font-medium text-gray-700 mb-1">1) PERLINDUNGAN DARI RESIKO KESEHATAN</label>
                                                <textarea id="kebutuhan-1" class="w-full p-2 border border-gray-200 rounded-md shadow-sm" rows="3" placeholder="Masukkan catatan..."></textarea>
                                            </td>
                                            <td class="p-3 w-1/2 align-top">
                                                <label for="kebutuhan-5" class="block text-sm font-medium text-gray-700 mb-1">5) KONDISI BIOLOGIS DAN FUNGSI GIGI GELIGI YANG BAIK</label>
                                                <textarea id="kebutuhan-5" class="w-full p-2 border border-gray-200 rounded-md shadow-sm" rows="3" placeholder="Masukkan catatan..."></textarea>
                                            </td>
                                        </tr>
                                        <!-- Baris 2 -->
                                        <tr class="divide-x divide-gray-300">
                                            <td class="p-3 w-1/2 align-top">
                                                <label for="kebutuhan-2" class="block text-sm font-medium text-gray-700 mb-1">2) BEBAS DARI KETAKUTAN/STRESS</label>
                                                <textarea id="kebutuhan-2" class="w-full p-2 border border-gray-200 rounded-md shadow-sm" rows="3" placeholder="Masukkan catatan..."></textarea>
                                            </td>
                                            <td class="p-3 w-1/2 align-top">
                                                <label for="kebutuhan-6" class="block text-sm font-medium text-gray-700 mb-1">6) KONSEPTUALISASI DAN PEMECAHAN MASALAH</label>
                                                <textarea id="kebutuhan-6" class="w-full p-2 border border-gray-200 rounded-md shadow-sm" rows="3" placeholder="Masukkan catatan..."></textarea>
                                            </td>
                                        </tr>
                                        <!-- Baris 3 -->
                                        <tr class="divide-x divide-gray-300">
                                            <td class="p-3 w-1/2 align-top">
                                                <label for="kebutuhan-3" class="block text-sm font-medium text-gray-700 mb-1">3) KESAN WAJAH YANG SEHAT</label>
                                                <textarea id="kebutuhan-3" class="w-full p-2 border border-gray-200 rounded-md shadow-sm" rows="3" placeholder="Masukkan catatan..."></textarea>
                                            </td>
                                            <td class="p-3 w-1/2 align-top">
                                                <label for="kebutuhan-7" class="block text-sm font-medium text-gray-700 mb-1">7) BEBAS DARI NYERI PADA KEPALA DAN LEHER</label>
                                                <textarea id="kebutuhan-7" class="w-full p-2 border border-gray-200 rounded-md shadow-sm" rows="3" placeholder="Masukkan catatan..."></textarea>
                                            </td>
                                        </tr>
                                        <!-- Baris 4 -->
                                        <tr class="divide-x divide-gray-300">
                                            <td class="p-3 w-1/2 align-top">
                                                <label for="kebutuhan-4" class="block text-sm font-medium text-gray-700 mb-1">4) KEUTUHAN KULIT DAN MEMBRAN MUKOSA PADA LEHER DAN KEPALA</label>
                                                <textarea id="kebutuhan-4" class="w-full p-2 border border-gray-200 rounded-md shadow-sm" rows="3" placeholder="Masukkan catatan..."></textarea>
                                            </td>
                                            <td class="p-3 w-1/2 align-top">
                                                <label for="kebutuhan-8" class="block text-sm font-medium text-gray-700 mb-1">8) TANGGUNG JAWAB TERHADAP KESEHATAN GIGI DAN MULUTNYA</label>
                                                <textarea id="kebutuhan-8" class="w-full p-2 border border-gray-200 rounded-md shadow-sm" rows="3" placeholder="Masukkan catatan..."></textarea>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Diagnosis -->
                        <div class="mb-4">
                            <div class="flex items-center gap-4 mb-2">
                                <h3 class="text-md font-semibold text-gray-700">Diagnosis Askesgilut</h3>
                                <button id="generate-diagnosis-btn" class="px-3 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-md hover:bg-blue-200 transition-all">
                                    Generate AI
                                </button>
                                <span id="ai-status" class="text-sm text-gray-500 italic"></span>
                            </div>
                            <textarea id="diagnosis-text" class="w-full p-2 border border-gray-300 rounded-md shadow-sm" rows="4" placeholder="Masukkan diagnosis... (atau gunakan Generate AI)"></textarea>
                            
                            <!-- Tambahan Catatan Penunjang (Vertikal) -->
                            <div class="mt-4">
                                <div>
                                    <label for="diagnosis-penyebab" class="block text-sm font-medium text-gray-700 mb-1">Penyebab (Etiologi)</label>
                                    <textarea id="diagnosis-penyebab" rows="3" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                                </div>
                                <div class="mt-4">
                                    <label for="diagnosis-tanda" class="block text-sm font-medium text-gray-700 mb-1">Tanda dan Gejala (Sign/Symptom)</label>
                                    <textarea id="diagnosis-tanda" rows="3" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Perencanaan -->
                        <div class="mb-4">
                            <h3 class="text-md font-semibold mt-4 mb-2 text-gray-700">Tujuan Yang Berpusat Pada Klien (Client-Centered Goals)</h3>
                            <textarea id="perencanaan-text" class="w-full p-2 border border-gray-300 rounded-md shadow-sm" rows="4" placeholder="Masukkan tujuan..."></textarea>
                        </div>

                        <!-- Implementasi -->
                        <div class="mb-4">
                            <h3 class="text-md font-semibold mt-4 mb-2 text-gray-700">Intervensi Askesgilut (Dental Hygiene Interventions)</h3>
                            <textarea id="implementasi-text" class="w-full p-2 border border-gray-300 rounded-md shadow-sm" rows="4" placeholder="Masukkan intervensi..."></textarea>
                        </div>

                        <!-- Evaluasi -->
                        <div class="mb-4">
                            <h3 class="text-md font-semibold mt-4 mb-2 text-gray-700">Pernyataan Evaluatif (Evaluative Statement)</h3>
                            <textarea id="evaluasi-text" class="w-full p-2 border border-gray-300 rounded-md shadow-sm" rows="4" placeholder="Masukkan pernyataan..."></textarea>
                        </div>

                        <!-- Tabel Rencana Perawatan -->
                        <div class="mt-6">
                            <h3 class="text-md font-semibold mb-2 text-gray-700">Rencana Perawatan</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse border border-gray-300">
                                    <thead>
                                        <tr class="bg-blue-50">
                                            <th class="border border-gray-300 p-2 text-left font-semibold">No</th>
                                            <th class="border border-gray-300 p-2 text-left font-semibold">Jenis Perawatan</th>
                                            <th class="border border-gray-300 p-2 text-left font-semibold">Deskripsi</th>
                                            <th class="border border-gray-300 p-2 text-left font-semibold">Target Waktu</th>
                                            <th class="border border-gray-300 p-2 text-left font-semibold">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="treatment-plan-body">
                                        <tr>
                                            <td class="border border-gray-300 p-2">1</td>
                                            <td class="border border-gray-300 p-2">
                                                <input type="text" class="w-full p-1 border border-gray-200 rounded" placeholder="Jenis perawatan">
                                            </td>
                                            <td class="border border-gray-300 p-2">
                                                <textarea class="w-full p-1 border border-gray-200 rounded" rows="2" placeholder="Deskripsi perawatan"></textarea>
                                            </td>
                                            <td class="border border-gray-300 p-2">
                                                <input type="text" class="w-full p-1 border border-gray-200 rounded" placeholder="Target waktu">
                                            </td>
                                            <td class="border border-gray-300 p-2">
                                                <select class="w-full p-1 border border-gray-200 rounded">
                                                    <option value="">Pilih status</option>
                                                    <option value="Rencana">Rencana</option>
                                                    <option value="Dalam Proses">Dalam Proses</option>
                                                    <option value="Selesai">Selesai</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="border border-gray-300 p-2">2</td>
                                            <td class="border border-gray-300 p-2">
                                                <input type="text" class="w-full p-1 border border-gray-200 rounded" placeholder="Jenis perawatan">
                                            </td>
                                            <td class="border border-gray-300 p-2">
                                                <textarea class="w-full p-1 border border-gray-200 rounded" rows="2" placeholder="Deskripsi perawatan"></textarea>
                                            </td>
                                            <td class="border border-gray-300 p-2">
                                                <input type="text" class="w-full p-1 border border-gray-200 rounded" placeholder="Target waktu">
                                            </td>
                                            <td class="border border-gray-300 p-2">
                                                <select class="w-full p-1 border border-gray-200 rounded">
                                                    <option value="">Pilih status</option>
                                                    <option value="Rencana">Rencana</option>
                                                    <option value="Dalam Proses">Dalam Proses</option>
                                                    <option value="Selesai">Selesai</option>
                                                </select>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-2 text-right">
                                <button type="button" id="add-treatment-row" class="btn-primary px-3 py-1 rounded-md text-sm">
                                    <i class="fas fa-plus mr-1"></i>Tambah Baris
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

        // Setup event listener untuk tombol Generate AI
        document
          .getElementById("generate-diagnosis-btn")
          .addEventListener("click", function () {
            // Simulasi generate diagnosis AI
            document.getElementById("ai-status").textContent =
              "Diagnosis berhasil dibuat!";
            setTimeout(() => {
              document.getElementById("ai-status").textContent = "";
            }, 3000);
          });

        // Setup event listeners untuk tombol Simpan dan Muat
        document
          .getElementById("save-button")
          .addEventListener("click", saveDiagnosisData);
        document
          .getElementById("load-button")
          .addEventListener("click", loadDiagnosisData);

        // Setup event listener untuk tombol tambah baris rencana perawatan
        document
          .getElementById("add-treatment-row")
          .addEventListener("click", function () {
            const tableBody = document.getElementById("treatment-plan-body");
            const rowCount = tableBody.children.length + 1;
            
            const newRow = document.createElement("tr");
            newRow.innerHTML = `
                <td class="border border-gray-300 p-2">${rowCount}</td>
                <td class="border border-gray-300 p-2">
                    <input type="text" class="w-full p-1 border border-gray-200 rounded" placeholder="Jenis perawatan">
                </td>
                <td class="border border-gray-300 p-2">
                    <textarea class="w-full p-1 border border-gray-200 rounded" rows="2" placeholder="Deskripsi perawatan"></textarea>
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" class="w-full p-1 border border-gray-200 rounded" placeholder="Target waktu">
                </td>
                <td class="border border-gray-300 p-2">
                    <select class="w-full p-1 border border-gray-200 rounded">
                        <option value="">Pilih status</option>
                        <option value="Rencana">Rencana</option>
                        <option value="Dalam Proses">Dalam Proses</option>
                        <option value="Selesai">Selesai</option>
                    </select>
                </td>
            `;
            tableBody.appendChild(newRow);
          });
      }

      // Load informed consent section
      function loadInformedConsentSection(container) {
        container.innerHTML = `
                <h3 class="text-xl font-semibold text-gray-800 mb-6">Informed Consent</h3>
                <div class="space-y-8">
                    <p class="text-gray-700 text-center text-lg">Yang bertanda tangan di bawah ini:</p>

                    <!-- Bagian Data Pasien dan Wali -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">

                        <!-- Kolom Pasien -->
                        <div>
                            <h2 class="text-xl font-semibold text-gray-800 border-b-2 border-blue-200 pb-2 mb-4">
                                Data Pasien
                            </h2>
                            <div class="space-y-4">
                                <div>
                                    <label for="patient-name" class="block text-sm font-medium text-gray-600 mb-1">Nama <span class="text-red-500">*</span></label>
                                    <input type="text" id="patient-name" name="patient-name" placeholder="Contoh: An. jora" class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label for="patient-age" class="block text-sm font-medium text-gray-600 mb-1">Umur <span class="text-red-500">*</span></label>
                                    <input type="number" id="patient-age" name="patient-age" placeholder="Contoh: 9" class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                    <span class="text-xs text-gray-500 ml-1">Tahun</span>
                                </div>
                                <div>
                                    <label for="patient-address" class="block text-sm font-medium text-gray-600 mb-1">Alamat <span class="text-red-500">*</span></label>
                                    <textarea id="patient-address" name="patient-address" rows="3" placeholder="Masukkan alamat lengkap pasien..." class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Kolom Orang Tua / Wali -->
                        <div>
                            <h2 class="text-xl font-semibold text-gray-800 border-b-2 border-blue-200 pb-2 mb-4">
                                Data Orang Tua / Wali Pasien
                            </h2>
                            <div class="space-y-4">
                                <div>
                                    <label for="guardian-name" class="block text-sm font-medium text-gray-600 mb-1">Nama <span class="text-red-500">*</span></label>
                                    <input type="text" id="guardian-name" name="guardian-name" placeholder="Contoh: ny. Tuti" class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label for="guardian-age" class="block text-sm font-medium text-gray-600 mb-1">Umur <span class="text-red-500">*</span></label>
                                    <input type="number" id="guardian-age" name="guardian-age" placeholder="Contoh: 28" class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                     <span class="text-xs text-gray-500 ml-1">Tahun</span>
                                </div>
                                <div>
                                    <label for="guardian-address" class="block text-sm font-medium text-gray-600 mb-1">Alamat <span class="text-red-500">*</span></label>
                                    <textarea id="guardian-address" name="guardian-address" rows="3" placeholder="Masukkan alamat lengkap wali..." class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bagian Teks Persetujuan -->
                    <div class="mt-10">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Isi Pernyataan Persetujuan</h2>
                        <div class="space-y-4 text-gray-700 leading-relaxed bg-gray-50 p-6 rounded-lg border border-gray-200">
                            <p>Menyatakan telah mendapat penerangan mengenai pemeriksaan dan perawatan yang akan dilaksanakan terhadap saya / anak saya, dengan akibat sampingan yang mungkin terjadi, jumlah kunjungan yang harus dilaksanakan serta biaya yang harus dibayar untuk pemeriksaan dan perawatan dimaksud.</p>
                            <p>Selanjutnya saya memberikan persetujuan kepada perawat gigi yang di tunjuk untuk melaksanakan tindakan asuhan keperawatan gigi kepada saya/anak saya sesuai dengan yang telah dijelaskan kepada saya sebelumnya.</p>
                            <p>Persetujuan ini diberikan dengan penuh kesadaran akan kemungkinan terjadinya akibat sampingan dari tindakan tersebut diatas.</p>
                            <p class="font-semibold mt-6">Demikian surat pernyataan ini dibuat dengan sesungguhnya dan penuh rasa tanggung jawab.</p>
                        </div>
                    </div>

                    <!-- Bagian Tanda Tangan Persetujuan (Pasien/Wali) -->
                    <div class="mt-10">
                        <h2 class="text-xl font-semibold text-gray-800 mb-6">Tanda Tangan Persetujuan</h2>
                        
                        <div class="mb-6">
                            <label for="consent-date-1" class="block text-sm font-medium text-gray-600 mb-1">Tanggal Persetujuan <span class="text-red-500">*</span></label>
                            <div class="flex items-center">
                                <span class="text-gray-700 mr-2">Bandung,</span>
                                <input type="date" id="consent-date-1" name="consent-date-1" class="w-full max-w-xs px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Tanda Tangan Wali -->
                            <div>
                                <label class="block text-sm font-medium text-gray-600 mb-1 text-center">Yang menyatakan,</label>
                                <label class="block text-sm font-semibold text-gray-700 mb-2 text-center">(Orang Tua / Wali Pasien)</label>
                                
                                <!-- Opsi Tanda Tangan Gambar -->
                                <div id="guardian-signature-draw-option">
                                    <p class="text-center text-sm text-gray-500 mb-2">Gambar tanda tangan Anda di sini:</p>
                                    <canvas id="guardian-signature-pad" class="signature-canvas" width="400" height="150"></canvas>
                                    <div class="text-center mt-2">
                                        <button type="button" id="clear-guardian-sig" class="text-sm text-blue-600 hover:text-blue-800 focus:outline-none mr-4">
                                            <i class="fas fa-eraser mr-1"></i>Bersihkan
                                        </button>
                                        <button type="button" id="toggle-guardian-upload" class="text-sm text-gray-600 hover:text-gray-800 focus:outline-none">
                                            <i class="fas fa-upload mr-1"></i>Unggah File
                                        </button>
                                    </div>
                                </div>

                                <!-- Opsi Unggah File Tanda Tangan -->
                                <div id="guardian-signature-upload-option" class="hidden mt-4">
                                    <p class="text-center text-sm text-gray-500 mb-2">Unggah file tanda tangan Anda:</p>
                                    <input type="file" id="guardian-signature-file" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <img id="guardian-signature-preview" class="uploaded-signature-preview hidden mx-auto" alt="Pratinjau Tanda Tangan Wali">
                                    <div class="text-center mt-2">
                                        <button type="button" id="clear-guardian-upload" class="text-sm text-red-600 hover:text-red-800 focus:outline-none mr-4 hidden">
                                            <i class="fas fa-trash mr-1"></i>Hapus
                                        </button>
                                        <button type="button" id="toggle-guardian-draw" class="text-sm text-gray-600 hover:text-gray-800 focus:outline-none">
                                            <i class="fas fa-pen mr-1"></i>Gambar TTD
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Input Nama -->
                                <input type="text" id="guardian-signature-name" name="guardian-signature-name" placeholder="Ketik nama lengkap wali..." class="w-full mt-3 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>

                            <!-- Tanda Tangan Saksi -->
                            <div>
                                <label class="block text-sm font-medium text-gray-600 mb-1 text-center">Saksi,</label>
                                 <label class="block text-sm font-semibold text-gray-700 mb-2 text-center">(..............................)</label>
                                
                                <!-- Opsi Tanda Tangan Gambar -->
                                <div id="witness-signature-draw-option">
                                    <p class="text-center text-sm text-gray-500 mb-2">Gambar tanda tangan Anda di sini:</p>
                                    <canvas id="witness-signature-pad" class="signature-canvas" width="400" height="150"></canvas>
                                    <div class="text-center mt-2">
                                        <button type="button" id="clear-witness-sig" class="text-sm text-blue-600 hover:text-blue-800 focus:outline-none mr-4">
                                            <i class="fas fa-eraser mr-1"></i>Bersihkan
                                        </button>
                                        <button type="button" id="toggle-witness-upload" class="text-sm text-gray-600 hover:text-gray-800 focus:outline-none">
                                            <i class="fas fa-upload mr-1"></i>Unggah File
                                        </button>
                                    </div>
                                </div>

                                <!-- Opsi Unggah File Tanda Tangan -->
                                <div id="witness-signature-upload-option" class="hidden mt-4">
                                    <p class="text-center text-sm text-gray-500 mb-2">Unggah file tanda tangan Anda:</p>
                                    <input type="file" id="witness-signature-file" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <img id="witness-signature-preview" class="uploaded-signature-preview hidden mx-auto" alt="Pratinjau Tanda Tangan Saksi">
                                    <div class="text-center mt-2">
                                        <button type="button" id="clear-witness-upload" class="text-sm text-red-600 hover:text-red-800 focus:outline-none mr-4 hidden">
                                            <i class="fas fa-trash mr-1"></i>Hapus
                                        </button>
                                        <button type="button" id="toggle-witness-draw" class="text-sm text-gray-600 hover:text-gray-800 focus:outline-none">
                                            <i class="fas fa-pen mr-1"></i>Gambar TTD
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Input Nama -->
                                <input type="text" id="witness-signature-name" name="witness-signature-name" placeholder="Ketik nama lengkap saksi..." class="w-full mt-3 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                        </div>
                    </div>

                    <!-- Garis Pemisah -->
                    <hr class="my-12 border-t-2 border-gray-200">

                    <!-- Bagian Pernyataan Pelaksana -->
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Pernyataan Pelaksana Perawatan Gigi</h2>
                        <div class="space-y-4 text-gray-700 leading-relaxed bg-gray-50 p-6 rounded-lg border border-gray-200">
                            <p>Saya menyatakan bahwa saya telah menjelaskan sifat dan tujuan serta kemungkinan akibat yang akan timbul dari tindakan perawatan gigi ini kepada pasien sendiri/orang tua/wali/istri/suami/keluarga lainnya terkecuali pasien tak sadar/gangguan mental.</p>
                        </div>
                    </div>

                    <!-- Bagian Tanda Tangan Pelaksana -->
                    <div class="mt-10">
                         <div class="mb-6">
                            <label for="operator-date" class="block text-sm font-medium text-gray-600 mb-1">Tanggal Pernyataan <span class="text-red-500">*</span></label>
                            <div class="flex items-center">
                                <span class="text-gray-700 mr-2">Bandung,</span>
                                <input type="date" id="operator-date" name="operator-date" class="w-full max-w-xs px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1 text-center">Yang menyatakan,</label>
                            <label class="block text-sm font-semibold text-gray-700 mb-2 text-center">Operator (Terapis Gigi dan Mulut / Mahasiswa)</label>

                            <!-- Opsi Tanda Tangan Gambar -->
                            <div id="operator-signature-draw-option">
                                <p class="text-center text-sm text-gray-500 mb-2">Gambar tanda tangan Anda di sini:</p>
                                <canvas id="operator-signature-pad" class="signature-canvas" width="400" height="150"></canvas>
                                <div class="text-center mt-2">
                                    <button type="button" id="clear-operator-sig" class="text-sm text-blue-600 hover:text-blue-800 focus:outline-none mr-4">
                                        <i class="fas fa-eraser mr-1"></i>Bersihkan
                                    </button>
                                    <button type="button" id="toggle-operator-upload" class="text-sm text-gray-600 hover:text-gray-800 focus:outline-none">
                                        <i class="fas fa-upload mr-1"></i>Unggah File
                                    </button>
                                </div>
                            </div>

                            <!-- Opsi Unggah File Tanda Tangan -->
                            <div id="operator-signature-upload-option" class="hidden mt-4">
                                <p class="text-center text-sm text-gray-500 mb-2">Unggah file tanda tangan Anda:</p>
                                <input type="file" id="operator-signature-file" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <img id="operator-signature-preview" class="uploaded-signature-preview hidden mx-auto" alt="Pratinjau Tanda Tangan Operator">
                                <div class="text-center mt-2">
                                    <button type="button" id="clear-operator-upload" class="text-sm text-red-600 hover:text-red-800 focus:outline-none mr-4 hidden">
                                        <i class="fas fa-trash mr-1"></i>Hapus
                                    </button>
                                    <button type="button" id="toggle-operator-draw" class="text-sm text-gray-600 hover:text-gray-800 focus:outline-none">
                                        <i class="fas fa-pen mr-1"></i>Gambar TTD
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Input Nama -->
                            <input type="text" id="operator-signature-name" name="operator-signature-name" placeholder="Ketik nama lengkap pelaksana..." class="w-full mt-3 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                    </div>

                    <!-- Tombol Submit -->
                    <div class="text-center mt-12">
                        <button type="button" id="saveConsentBtn" class="bg-blue-600 text-white font-bold py-3 px-10 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-300 text-lg">
                            <i class="fas fa-save mr-2"></i>Simpan Persetujuan
                        </button>
                    </div>
                </div>
            `;

        // Setup signature pads
        setupSignaturePads();

        // Setup event listener untuk tombol simpan consent
        document
          .getElementById("saveConsentBtn")
          .addEventListener("click", function () {
            if (validateInformedConsent()) {
              document
                .getElementById("success-modal")
                .classList.remove("hidden");
            } else {
              alert(
                "Harap lengkapi semua field yang wajib diisi sebelum menyimpan."
              );
            }
          });
      }

      // Setup conditional fields
      function setupConditionalFields() {
        // Setup untuk semua radio buttons yang memiliki detail fields
        const conditionalRadios = document.querySelectorAll(
          'input[type="radio"]'
        );
        conditionalRadios.forEach((radio) => {
          radio.addEventListener("change", function () {
            const name = this.name;
            const value = this.value;
            const detailId = `${name}Detail`;
            const detailElement = document.getElementById(detailId);

            if (detailElement) {
              if (value === "Ya") {
                detailElement.classList.remove("hidden");
              } else {
                detailElement.classList.add("hidden");
              }
            }
          });
        });
      }

      // Setup OHI-S dan Plaque Control
      function setupOhisAndPlaqueControl() {
        // --- Bagian Plaque Control ---
        const surfaces = document.querySelectorAll(".surface");

        // --- Elemen untuk menampilkan hasil ---
        const plaqueResultEl = document.getElementById("plaqueResult");
        const plaqueCategoryEl = document.getElementById(
          "plaqueResultCategory"
        );

        // Menghitung total permukaan (jumlah gigi * 4)
        const totalSurfaces =
          document.querySelectorAll(".plaque-tooth").length * 4;

        // --- Fungsi untuk menghitung dan memperbarui skor plak ---
        function updatePlaqueScore() {
          // 1. Hitung jumlah permukaan yang dipilih (memiliki kelas 'selected')
          const selectedSurfaces =
            document.querySelectorAll(".surface.selected").length;

          // 2. Hitung persentase
          let percentage = 0;
          if (totalSurfaces > 0) {
            // Rumus: (Jumlah Plak / Total Permukaan) * 100
            percentage = (selectedSurfaces / totalSurfaces) * 100;
          }

          // 3. Update teks hasil persentase
          plaqueResultEl.textContent = percentage.toFixed(2) + "%";

          // 4. Update kategori (Baik/Buruk) dan warnanya
          if (percentage < 15) {
            plaqueCategoryEl.textContent = "(Baik)";
            plaqueCategoryEl.className =
              "text-lg font-semibold ml-2 text-green-600";
          } else {
            plaqueCategoryEl.textContent = "(Buruk)";
            plaqueCategoryEl.className =
              "text-lg font-semibold ml-2 text-red-600";
          }
        }

        // --- Menambahkan event listener ke setiap permukaan ---
        surfaces.forEach((surface) => {
          surface.addEventListener("click", (e) => {
            // Toggle kelas 'selected' saat diklik
            e.target.classList.toggle("selected");

            // Panggil fungsi update skor setiap kali ada klik
            updatePlaqueScore();
          });
        });

        // --- Bagian untuk OHI-S ---

        // 1. Pilih elemen input
        const debrisInputs = document.querySelectorAll(".ohis-debris");
        const calculusInputs = document.querySelectorAll(".ohis-calculus");
        const allOhisInputs = document.querySelectorAll(
          ".ohis-debris, .ohis-calculus"
        );

        // 2. Pilih elemen output
        const diResultEl = document.getElementById("diResult");
        const ciResultEl = document.getElementById("ciResult");
        const ohisResultEl = document.getElementById("ohisResult");

        // 3. Buat fungsi kalkulasi
        function calculateOhis() {
          let debrisSum = 0;
          debrisInputs.forEach((input) => {
            debrisSum += parseFloat(input.value) || 0;
          });
          const diScore =
            debrisInputs.length > 0 ? debrisSum / debrisInputs.length : 0;

          let calculusSum = 0;
          calculusInputs.forEach((input) => {
            calculusSum += parseFloat(input.value) || 0;
          });
          const ciScore =
            calculusInputs.length > 0 ? calculusSum / calculusInputs.length : 0;

          const ohisScore = diScore + ciScore;

          // 4. Update UI dengan 2 angka desimal
          diResultEl.textContent = diScore.toFixed(2);
          ciResultEl.textContent = ciScore.toFixed(2);
          ohisResultEl.textContent = ohisScore.toFixed(2);
        }

        // 5. Tambahkan event listener ke semua input OHI-S
        allOhisInputs.forEach((input) => {
          input.addEventListener("input", calculateOhis);
        });
      }

      // Setup signature pads
      function setupSignaturePads() {
        // Inisialisasi SignaturePad untuk setiap canvas
        const guardianCanvas = document.getElementById(
          "guardian-signature-pad"
        );
        const witnessCanvas = document.getElementById("witness-signature-pad");
        const operatorCanvas = document.getElementById(
          "operator-signature-pad"
        );

        // Optimasi canvas untuk tampilan yang lebih baik
        [guardianCanvas, witnessCanvas, operatorCanvas].forEach((canvas) => {
          canvas.width = canvas.offsetWidth;
          canvas.height = canvas.offsetHeight;
        });

        const guardianPad = new SignaturePad(guardianCanvas, {
          backgroundColor: "rgb(247, 250, 252)",
          penColor: "rgb(0, 0, 0)",
          throttle: 16,
        });

        const witnessPad = new SignaturePad(witnessCanvas, {
          backgroundColor: "rgb(247, 250, 252)",
          penColor: "rgb(0, 0, 0)",
          throttle: 16,
        });

        const operatorPad = new SignaturePad(operatorCanvas, {
          backgroundColor: "rgb(247, 250, 252)",
          penColor: "rgb(0, 0, 0)",
          throttle: 16,
        });

        // Setup untuk tombol clear
        document
          .getElementById("clear-guardian-sig")
          .addEventListener("click", function () {
            guardianPad.clear();
          });

        document
          .getElementById("clear-witness-sig")
          .addEventListener("click", function () {
            witnessPad.clear();
          });

        document
          .getElementById("clear-operator-sig")
          .addEventListener("click", function () {
            operatorPad.clear();
          });

        // Setup untuk toggle upload/draw
        document
          .getElementById("toggle-guardian-upload")
          .addEventListener("click", function () {
            document
              .getElementById("guardian-signature-draw-option")
              .classList.add("hidden");
            document
              .getElementById("guardian-signature-upload-option")
              .classList.remove("hidden");
          });

        document
          .getElementById("toggle-guardian-draw")
          .addEventListener("click", function () {
            document
              .getElementById("guardian-signature-upload-option")
              .classList.add("hidden");
            document
              .getElementById("guardian-signature-draw-option")
              .classList.remove("hidden");
          });

        document
          .getElementById("toggle-witness-upload")
          .addEventListener("click", function () {
            document
              .getElementById("witness-signature-draw-option")
              .classList.add("hidden");
            document
              .getElementById("witness-signature-upload-option")
              .classList.remove("hidden");
          });

        document
          .getElementById("toggle-witness-draw")
          .addEventListener("click", function () {
            document
              .getElementById("witness-signature-upload-option")
              .classList.add("hidden");
            document
              .getElementById("witness-signature-draw-option")
              .classList.remove("hidden");
          });

        document
          .getElementById("toggle-operator-upload")
          .addEventListener("click", function () {
            document
              .getElementById("operator-signature-draw-option")
              .classList.add("hidden");
            document
              .getElementById("operator-signature-upload-option")
              .classList.remove("hidden");
          });

        document
          .getElementById("toggle-operator-draw")
          .addEventListener("click", function () {
            document
              .getElementById("operator-signature-upload-option")
              .classList.add("hidden");
            document
              .getElementById("operator-signature-draw-option")
              .classList.remove("hidden");
          });

        // Setup untuk file upload
        document
          .getElementById("guardian-signature-file")
          .addEventListener("change", function (e) {
            handleSignatureUpload(
              e,
              "guardian-signature-preview",
              "clear-guardian-upload"
            );
          });

        document
          .getElementById("witness-signature-file")
          .addEventListener("change", function (e) {
            handleSignatureUpload(
              e,
              "witness-signature-preview",
              "clear-witness-upload"
            );
          });

        document
          .getElementById("operator-signature-file")
          .addEventListener("change", function (e) {
            handleSignatureUpload(
              e,
              "operator-signature-preview",
              "clear-operator-upload"
            );
          });

        // Setup untuk clear upload
        document
          .getElementById("clear-guardian-upload")
          .addEventListener("click", function () {
            clearSignatureUpload(
              "guardian-signature-file",
              "guardian-signature-preview",
              "clear-guardian-upload"
            );
          });

        document
          .getElementById("clear-witness-upload")
          .addEventListener("click", function () {
            clearSignatureUpload(
              "witness-signature-file",
              "witness-signature-preview",
              "clear-witness-upload"
            );
          });

        document
          .getElementById("clear-operator-upload")
          .addEventListener("click", function () {
            clearSignatureUpload(
              "operator-signature-file",
              "operator-signature-preview",
              "clear-operator-upload"
            );
          });
      }

      // Handle signature upload
      function handleSignatureUpload(event, previewId, clearButtonId) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const preview = document.getElementById(previewId);
            preview.src = e.target.result;
            preview.classList.remove("hidden");
            document.getElementById(clearButtonId).classList.remove("hidden");
          };
          reader.readAsDataURL(file);
        }
      }

      // Clear signature upload
      function clearSignatureUpload(fileInputId, previewId, clearButtonId) {
        document.getElementById(fileInputId).value = "";
        document.getElementById(previewId).src = "";
        document.getElementById(previewId).classList.add("hidden");
        document.getElementById(clearButtonId).classList.add("hidden");
      }

      // Validate informed consent
      function validateInformedConsent() {
        const requiredFields = [
          "patient-name",
          "patient-age",
          "patient-address",
          "guardian-name",
          "guardian-age",
          "guardian-address",
          "consent-date-1",
          "operator-date",
          "guardian-signature-name",
          "witness-signature-name",
          "operator-signature-name",
        ];

        for (let fieldId of requiredFields) {
          const field = document.getElementById(fieldId);
          if (!field || !field.value.trim()) {
            return false;
          }
        }

        return true;
      }

      // Initialize odontogram
      function initializeOdontogram() {
        const toolButtonsContainer = document.getElementById(
          "tool-buttons-container"
        );
        const toolButtons = document.querySelectorAll(".tool-button");
        const currentToolDisplay = document.getElementById(
          "current-tool-display"
        );
        const clearAllButton = document.getElementById("clear-all-button");
        const odontogramContainer = document.getElementById(
          "odontogram-container"
        );

        // Tombol & Status Simpan/Muat
        const saveButton = document.getElementById("save-button");
        const loadButton = document.getElementById("load-button");
        const saveStatus = document.getElementById("save-status");

        let selectedTool = "clear";

        // Inisialisasi Odontogram
        renderAllTeethSVG();
        initOdontogramState();
        renderAllUIFromState();

        // --- Event Listeners ---

        toolButtonsContainer.addEventListener("click", (e) => {
          const button = e.target.closest(".tool-button");
          if (!button) return;

          selectedTool = button.dataset.tool;
          currentToolDisplay.textContent = button.textContent.split(" (")[0];

          toolButtons.forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");
        });

        odontogramContainer.addEventListener("click", (e) => {
          const part = e.target.closest(".tooth-part");
          const tooth = e.target.closest(".tooth-svg");
          if (!part && !tooth) return;

          const toothContainer = (part || tooth).closest(".tooth-container");
          const toothId = toothContainer.dataset.toothId;
          const surface = part ? part.dataset.part : null;

          // 1. Update State
          updateOdontogramState(toothId, surface, selectedTool);
          // 2. Render Ulang UI untuk gigi ini
          updateToothUI(toothId);
          updateStatusInputUI(toothId);
        });

        clearAllButton.addEventListener("click", () => {
          initOdontogramState();
          renderAllUIFromState();

          // Reset alat ke Clear
          toolButtons.forEach((btn) => btn.classList.remove("active"));
          document
            .querySelector('.tool-button[data-tool="clear"]')
            .classList.add("active");
          selectedTool = "clear";
          currentToolDisplay.textContent = "Clear";
        });

        saveButton.addEventListener("click", saveOdontogramData);
        loadButton.addEventListener("click", loadOdontogramData);
      }

      // Odontogram state management
      let odontogramState = {};

      // Tool styles and overlays
      const toolStyles = {
        clear: "fill-white",
        caries: "fill-red-500",
        filling: "fill-blue-600",
        amalgam: "fill-gray-500",
        sealant: "fill-green-600",
      };

      const overlayTools = {
        missing: {
          text: "M",
          fill: "rgb(0 0 0)",
          bg: "rgb(229 231 235)",
          fontSize: "text-6xl",
        },
        extraction: {
          text: "X",
          fill: "rgb(220 38 38)",
          bg: "rgb(254 202 202)",
          fontSize: "text-6xl",
        },
        fracture: {
          text: "#",
          fill: "rgb(234 179 8)",
          bg: "rgb(254 249 195)",
          fontSize: "text-6xl",
        },
        rrx: {
          text: "RRX",
          fill: "rgb(180 83 9)",
          bg: "rgb(254 243 199)",
          fontSize: "text-4xl-overlay",
        },
        nvt: {
          text: "NVT",
          fill: "rgb(147 51 234)",
          bg: "rgb(243 232 255)",
          fontSize: "text-4xl-overlay",
        },
        rct: {
          text: "RCT",
          fill: "rgb(8 145 178)",
          bg: "rgb(207 250 254)",
          fontSize: "text-4xl-overlay",
        },
        non: {
          text: "NON",
          fill: "rgb(156 163 175)",
          bg: "rgb(243 244 246)",
          fontSize: "text-4xl-overlay",
        },
        une: {
          text: "UNE",
          fill: "rgb(13 148 136)",
          bg: "rgb(204 251 241)",
          fontSize: "text-4xl-overlay",
        },
        pre: {
          text: "PRE",
          fill: "rgb(15 118 110)",
          bg: "rgb(173 241 228)",
          fontSize: "text-4xl-overlay",
        },
        ano: {
          text: "ANO",
          fill: "rgb(234 88 12)",
          bg: "rgb(255 237 213)",
          fontSize: "text-4xl-overlay",
        },
        fmc: {
          text: "FMC",
          fill: "rgb(51 65 85)",
          bg: "rgb(226 232 240)",
          fontSize: "text-4xl-overlay",
        },
        "fmc-rct": {
          text: "FMC-RCT",
          fill: "rgb(30 41 59)",
          bg: "rgb(203 213 225)",
          fontSize: "text-3xl-overlay",
        },
        poc: {
          text: "POC",
          fill: "rgb(2 132 199)",
          bg: "rgb(224 242 254)",
          fontSize: "text-4xl-overlay",
        },
        "poc-rct": {
          text: "POC-RCT",
          fill: "rgb(3 105 161)",
          bg: "rgb(186 230 253)",
          fontSize: "text-3xl-overlay",
        },
        "ipx-poc": {
          text: "IPX",
          fill: "rgb(79 70 229)",
          bg: "rgb(224 231 255)",
          fontSize: "text-4xl-overlay",
        },
        meb: {
          text: "MEB",
          fill: "rgb(75 85 99)",
          bg: "rgb(209 213 219)",
          fontSize: "text-4xl-overlay",
        },
        pob: {
          text: "POB",
          fill: "rgb(30 64 175)",
          bg: "rgb(191 219 254)",
          fontSize: "text-4xl-overlay",
        },
        "prd-fld": {
          text: "PRD/FLD",
          fill: "rgb(219 39 119)",
          bg: "rgb(253 232 240)",
          fontSize: "text-3xl-overlay",
        },
      };
      const overlayToolKeys = Object.keys(overlayTools);

      const toolAbbreviations = {
        caries: "CAR",
        filling: "COF",
        amalgam: "AMF",
        sealant: "FIS",
        missing: "M",
        extraction: "X",
        fracture: "#",
        rrx: "RRX",
        nvt: "NVT",
        rct: "RCT",
        non: "NON",
        une: "UNE",
        pre: "PRE",
        ano: "ANO",
        fmc: "FMC",
        "fmc-rct": "FMC-RCT",
        poc: "POC",
        "poc-rct": "POC-RCT",
        "ipx-poc": "IPX-POC",
        meb: "MEB",
        pob: "POB",
        "prd-fld": "PRD/FLD",
        clear: "clear",
      };

      /** Inisialisasi state untuk semua gigi ke default */
      function initOdontogramState() {
        odontogramState = {};
        const allTeeth = [
          ...[...Array(8).keys()].map((i) => 18 - i),
          ...[...Array(8).keys()].map((i) => 21 + i),
          ...[...Array(5).keys()].map((i) => 55 - i),
          ...[...Array(5).keys()].map((i) => 61 + i),
          ...[...Array(5).keys()].map((i) => 85 - i),
          ...[...Array(5).keys()].map((i) => 71 + i),
          ...[...Array(8).keys()].map((i) => 48 - i),
          ...[...Array(8).keys()].map((i) => 31 + i),
        ];

        const defaultUne = [
          "18",
          "17",
          "26",
          "27",
          "28",
          "48",
          "47",
          "38",
          "37",
        ];

        allTeeth.forEach((id) => {
          const status = defaultUne.includes(String(id)) ? "une" : "sou";
          odontogramState[id] = {
            surfaces: {
              V: "clear",
              L: "clear",
              M: "clear",
              D: "clear",
              O: "clear",
            },
            overlay: defaultUne.includes(String(id)) ? "une" : null,
            statusText: status === "une" ? "Une" : "Sou",
          };
        });
      }

      /**
       * Update state JS untuk satu gigi berdasarkan alat yang dipilih.
       * @param {string} toothId - ID Gigi (misal '46')
       * @param {string|null} surface - Permukaan ('V', 'O', dll) atau null
       * @param {string} tool - Alat yang dipilih (misal 'caries')
       */
      function updateOdontogramState(toothId, surface, tool) {
        if (!odontogramState[toothId]) return;
        let state = odontogramState[toothId];

        if (overlayToolKeys.includes(tool)) {
          // Alat overlay
          state.overlay = tool;
          state.surfaces = {
            V: "clear",
            L: "clear",
            M: "clear",
            D: "clear",
            O: "clear",
          }; // Reset permukaan
        } else if (tool === "clear") {
          if (surface) {
            // Clear satu permukaan
            state.surfaces[surface] = "clear";
            if (state.overlay) state.overlay = null; // Hapus overlay jika ada
          } else {
            // Clear seluruh gigi (klik pada overlay dengan alat clear)
            state.surfaces = {
              V: "clear",
              L: "clear",
              M: "clear",
              D: "clear",
              O: "clear",
            };
            state.overlay = null;
          }
        } else if (surface && toolStyles[tool]) {
          // Alat permukaan (Karies, Tumpatan, dll)
          state.surfaces[surface] = tool;
          state.overlay = null; // Hapus overlay jika ada
        }

        // Perbarui statusText
        state.statusText = generateStatusText(state);
      }

      /** Menghasilkan teks status (misal "O CAR, M COF") dari state */
      function generateStatusText(state) {
        if (state.overlay) {
          return toolAbbreviations[state.overlay].toUpperCase();
        }

        const parts = [];
        for (const [surface, tool] of Object.entries(state.surfaces)) {
          if (tool !== "clear") {
            parts.push(
              `${surface.toUpperCase()} ${toolAbbreviations[
                tool
              ].toUpperCase()}`
            );
          }
        }

        return parts.length > 0 ? parts.join(", ") : "Sou";
      }

      // --- Fungsi Render UI ---

      /** Render ulang SEMUA gigi & input berdasarkan odontogramState */
      function renderAllUIFromState() {
        for (const toothId in odontogramState) {
          updateToothUI(toothId);
          updateStatusInputUI(toothId);
        }
      }

      /** Render ulang SATU SVG gigi berdasarkan state */
      function updateToothUI(toothId) {
        const toothContainer = document.querySelector(
          `.tooth-container[data-tooth-id="${toothId}"]`
        );
        if (!toothContainer) return;

        const state = odontogramState[toothId];
        const svg = toothContainer.querySelector(".tooth-svg");
        const partsGroup = svg.querySelector(".tooth-parts-group");
        const overlayGroup = svg.querySelector(".tooth-overlay-group");
        const overlayText = overlayGroup.querySelector("text");
        const overlayRect = overlayGroup.querySelector("rect");

        overlayText.classList.remove(
          "text-6xl",
          "text-4xl-overlay",
          "text-3xl-overlay"
        );

        if (state.overlay) {
          // Tampilkan Overlay
          const toolData = overlayTools[state.overlay];
          partsGroup.style.display = "none";
          overlayGroup.style.display = "block";

          overlayText.textContent = toolData.text;
          overlayText.setAttribute("fill", toolData.fill);
          overlayRect.setAttribute("fill", toolData.bg);
          overlayText.classList.add(toolData.fontSize);
        } else {
          // Tampilkan Permukaan
          partsGroup.style.display = "block";
          overlayGroup.style.display = "none";

          for (const [surface, tool] of Object.entries(state.surfaces)) {
            const part = partsGroup.querySelector(`[data-part="${surface}"]`);
            if (part) {
              part.classList.remove(...Object.values(toolStyles));
              part.classList.add(toolStyles[tool] || "fill-white");
            }
          }
        }
      }

      /** Render ulang SATU input teks berdasarkan state */
      function updateStatusInputUI(toothId) {
        const input = document.querySelector(
          `.status-input[data-tooth="${toothId}"]`
        );
        if (input && odontogramState[toothId]) {
          input.value = odontogramState[toothId].statusText;
        }
      }

      /** Render semua SVG gigi ke DOM saat load */
      function renderAllTeethSVG() {
        function createToothSVG(number) {
          const isPrimary = number >= 51 && number <= 85;
          const sizeClass = isPrimary ? "w-10 h-10" : "w-12 h-12";
          const numberClass = isPrimary ? "text-blue-600" : "text-gray-700";

          return `
                    <div class="tooth-container flex flex-col items-center mx-px" data-tooth-id="${number}">
                        <span class="tooth-number text-sm font-medium ${numberClass}">${number}</span>
                        <svg class="tooth-svg ${sizeClass} cursor-pointer" viewBox="0 0 100 100">
                            <!-- Grup 5 Permukaan -->
                            <g class="tooth-parts-group">
                                <path data-part="V" class="tooth-part stroke-gray-600 stroke-2 fill-white transition-all" d="M 0 0 L 100 0 L 70 30 L 30 30 Z"></path>
                                <path data-part="L" class="tooth-part stroke-gray-600 stroke-2 fill-white transition-all" d="M 0 100 L 100 100 L 70 70 L 30 70 Z"></path>
                                <path data-part="M" class="tooth-part stroke-gray-600 stroke-2 fill-white transition-all" d="M 0 0 L 30 30 L 30 70 L 0 100 Z"></path>
                                <path data-part="D" class="tooth-part stroke-gray-600 stroke-2 fill-white transition-all" d="M 100 0 L 100 100 L 70 70 L 70 30 Z"></path>
                                <path data-part="O" class="tooth-part stroke-gray-600 stroke-2 fill-white transition-all" d="M 30 30 L 70 30 L 70 70 L 30 70 Z"></path>
                            </g>
                            <!-- Grup Overlay untuk Hilang/Ekstraksi -->
                            <g class="tooth-overlay-group" style="display: none;">
                                <rect x="0" y="0" width="100" height="100" class="stroke-gray-600 stroke-2" fill="white"></rect>
                                <text x="50" y="58" text-anchor="middle" class="text-6xl font-bold" fill="black">X</text>
                            </g>
                        </svg>
                    </div>
                `;
        }

        const rows = {
          "row-1": [
            ...[18, 17, 16, 15, 14, 13, 12, 11].map(createToothSVG),
            '<div class="w-4 border-l-2 border-gray-400 h-12 self-center"></div>',
            ...[21, 22, 23, 24, 25, 26, 27, 28].map(createToothSVG),
          ],
          "row-2": [
            ...[55, 54, 53, 52, 51].map(createToothSVG),
            '<div class="w-4 border-l-2 border-gray-400 h-10 self-center"></div>',
            ...[61, 62, 63, 64, 65].map(createToothSVG),
          ],
          "row-3": [
            ...[85, 84, 83, 82, 81].map(createToothSVG),
            '<div class="w-4 border-l-2 border-gray-400 h-10 self-center"></div>',
            ...[71, 72, 73, 74, 75].map(createToothSVG),
          ],
          "row-4": [
            ...[48, 47, 46, 45, 44, 43, 42, 41].map(createToothSVG),
            '<div class="w-4 border-l-2 border-gray-400 h-12 self-center"></div>',
            ...[31, 32, 33, 34, 35, 36, 37, 38].map(createToothSVG),
          ],
        };

        document
          .getElementById("row-2")
          .classList.add("pl-[120px]", "pr-[120px]");
        document
          .getElementById("row-3")
          .classList.add("pl-[120px]", "pr-[120px]");

        for (const rowId in rows) {
          document.getElementById(rowId).innerHTML = rows[rowId].join("");
        }
      }

      // Save odontogram data
      async function saveOdontogramData() {
        const clientId = document.getElementById("client-id").value;
        const fillDate = document.getElementById("fill-date").value;

        if (!clientId) {
          alert("No. ID Klien wajib diisi untuk menyimpan.");
          return;
        }

        // Simpan data ke Supabase
        const data = {
          client_id: clientId,
          fill_date: fillDate,
          teeth: odontogramState,
          created_at: new Date().toISOString(),
          operator_id: currentUser.id
        };

        try {
          const { data: result, error } = await supabase
            .from('odontograms')
            .upsert([data], { onConflict: 'client_id' });

          if (error) {
            console.error('Save odontogram error:', error);
            document.getElementById("save-status").textContent =
              "Gagal menyimpan data!";
          } else {
            document.getElementById("save-status").textContent =
              "Data berhasil disimpan!";
          }
        } catch (error) {
          console.error('Save odontogram error:', error);
          document.getElementById("save-status").textContent =
            "Gagal menyimpan data!";
        }

        setTimeout(() => {
          document.getElementById("save-status").textContent = "";
        }, 3000);
      }

      // Load odontogram data
      async function loadOdontogramData() {
        const clientId = document.getElementById("client-id").value;
        if (!clientId) {
          alert("No. ID Klien wajib diisi untuk memuat.");
          return;
        }

        try {
          const { data: result, error } = await supabase
            .from('odontograms')
            .select('*')
            .eq('client_id', clientId)
            .single();

          if (error) {
            console.error('Load odontogram error:', error);
            document.getElementById("save-status").textContent =
              "Data tidak ditemukan!";
          } else if (result) {
            odontogramState = result.teeth;
            document.getElementById("fill-date").value = result.fill_date;
            renderAllUIFromState();
            document.getElementById("save-status").textContent =
              "Data berhasil dimuat!";
          } else {
            document.getElementById("save-status").textContent =
              "Data tidak ditemukan!";
          }
        } catch (error) {
          console.error('Load odontogram error:', error);
          document.getElementById("save-status").textContent =
            "Gagal memuat data!";
        }

        setTimeout(() => {
          document.getElementById("save-status").textContent = "";
        }, 3000);
      }

      // Save diagnosis data
      async function saveDiagnosisData() {
        const clientId = document.getElementById("client-id").value;
        const fillDate = document.getElementById("fill-date").value;

        if (!clientId) {
          alert("No. ID Klien wajib diisi untuk menyimpan.");
          return;
        }

        // Kumpulkan semua data diagnosis
        const diagnosisData = {
          client_id: clientId,
          fill_date: fillDate,
          kebutuhan1: document.getElementById("kebutuhan-1").value,
          kebutuhan2: document.getElementById("kebutuhan-2").value,
          kebutuhan3: document.getElementById("kebutuhan-3").value,
          kebutuhan4: document.getElementById("kebutuhan-4").value,
          kebutuhan5: document.getElementById("kebutuhan-5").value,
          kebutuhan6: document.getElementById("kebutuhan-6").value,
          kebutuhan7: document.getElementById("kebutuhan-7").value,
          kebutuhan8: document.getElementById("kebutuhan-8").value,
          diagnosis_text: document.getElementById("diagnosis-text").value,
          diagnosis_penyebab: document.getElementById("diagnosis-penyebab").value,
          diagnosis_tanda: document.getElementById("diagnosis-tanda").value,
          perencanaan_text: document.getElementById("perencanaan-text").value,
          implementasi_text: document.getElementById("implementasi-text").value,
          evaluasi_text: document.getElementById("evaluasi-text").value,
          created_at: new Date().toISOString(),
          operator_id: currentUser.id
        };

        try {
          const { data, error } = await supabase
            .from('diagnoses')
            .upsert([diagnosisData], { onConflict: 'client_id' });

          if (error) {
            console.error('Save diagnosis error:', error);
            document.getElementById("save-status").textContent =
              "Gagal menyimpan data diagnosis!";
          } else {
            document.getElementById("save-status").textContent =
              "Data diagnosis berhasil disimpan!";
          }
        } catch (error) {
          console.error('Save diagnosis error:', error);
          document.getElementById("save-status").textContent =
              "Gagal menyimpan data diagnosis!";
        }

        setTimeout(() => {
          document.getElementById("save-status").textContent = "";
        }, 3000);
      }

      // Load diagnosis data
      async function loadDiagnosisData() {
        const clientId = document.getElementById("client-id").value;
        if (!clientId) {
          alert("No. ID Klien wajib diisi untuk memuat.");
          return;
        }

        try {
          const { data: result, error } = await supabase
            .from('diagnoses')
            .select('*')
            .eq('client_id', clientId)
            .single();

          if (error) {
            console.error('Load diagnosis error:', error);
            document.getElementById("save-status").textContent =
              "Data diagnosis tidak ditemukan!";
          } else if (result) {
            // Isi semua field dengan data yang dimuat
            document.getElementById("fill-date").value =
              result.fill_date || "";
            document.getElementById("kebutuhan-1").value =
              result.kebutuhan1 || "";
            document.getElementById("kebutuhan-2").value =
              result.kebutuhan2 || "";
            document.getElementById("kebutuhan-3").value =
              result.kebutuhan3 || "";
            document.getElementById("kebutuhan-4").value =
              result.kebutuhan4 || "";
            document.getElementById("kebutuhan-5").value =
              result.kebutuhan5 || "";
            document.getElementById("kebutuhan-6").value =
              result.kebutuhan6 || "";
            document.getElementById("kebutuhan-7").value =
              result.kebutuhan7 || "";
            document.getElementById("kebutuhan-8").value =
              result.kebutuhan8 || "";
            document.getElementById("diagnosis-text").value =
              result.diagnosis_text || "";
            document.getElementById("diagnosis-penyebab").value =
              result.diagnosis_penyebab || "";
            document.getElementById("diagnosis-tanda").value =
              result.diagnosis_tanda || "";
            document.getElementById("perencanaan-text").value =
              result.perencanaan_text || "";
            document.getElementById("implementasi-text").value =
              result.implementasi_text || "";
            document.getElementById("evaluasi-text").value =
              result.evaluasi_text || "";

            document.getElementById("save-status").textContent =
              "Data diagnosis berhasil dimuat!";
          } else {
            document.getElementById("save-status").textContent =
              "Data diagnosis tidak ditemukan!";
          }
        } catch (error) {
          console.error('Load diagnosis error:', error);
          document.getElementById("save-status").textContent =
            "Gagal memuat data diagnosis!";
        }

        setTimeout(() => {
          document.getElementById("save-status").textContent = "";
        }, 3000);
      }

      // Fungsi untuk menyimpan data medis
      async function saveMedicalRecord() {
        // Kumpulkan data dari semua section
        const clientId = document.getElementById("clientIDField").value;
        
        // Kumpulkan data demografi
        const demographicData = {
          nama: document.getElementById("demographic-nama")?.value || "",
          jenisKelamin: document.getElementById("demographic-jenis-kelamin")?.value || "",
          umur: document.getElementById("demographic-umur")?.value || "",
          agama: document.getElementById("demographic-agama")?.value || "",
          tanggalLahir: document.getElementById("demographic-tanggal-lahir")?.value || "",
          tempatLahir: document.getElementById("demographic-tempat-lahir")?.value || "",
          pekerjaan: document.getElementById("demographic-pekerjaan")?.value || "",
          bangsa: document.getElementById("demographic-bangsa")?.value || "",
          alamat: document.getElementById("demographic-alamat")?.value || "",
          golonganDarah: document.getElementById("demographic-golongan-darah")?.value || "",
          status: document.getElementById("demographic-status")?.value || "",
          telepon: document.getElementById("demographic-telepon")?.value || "",
          tanggungan: document.getElementById("demographic-tanggungan")?.value || "",
          suku: document.getElementById("demographic-suku")?.value || "",
          beratBadan: document.getElementById("demographic-berat-badan")?.value || "",
          tinggiBadan: document.getElementById("demographic-tinggi-badan")?.value || "",
          asuransi: document.getElementById("demographic-asuransi")?.value || "",
          rujukan: document.getElementById("demographic-rujukan")?.value || "",
        };

        // Simpan data ke Supabase
        const patientRecord = {
          client_id: clientId,
          tanggal: new Date().toISOString(),
          operator_id: currentUser.id,
          operator_name: currentUser.user_metadata?.full_name || currentUser.email,
          operator_nim: currentUser.user_metadata?.nim || '-',
          demographic: demographicData,
          medicalHistory: {},
          dentalHistory: {},
          oralHygiene: {},
          dietaryHabits: {},
          clinicalExamination: {},
          softTissue: {},
          diagnosis: {},
          informedConsent: {},
        };

        try {
          const { data, error } = await supabase
            .from('patients')
            .upsert([patientRecord], { onConflict: 'client_id' });

          if (error) {
            console.error('Save patient error:', error);
            alert("Gagal menyimpan data pasien!");
          } else {
            alert("Data pasien berhasil disimpan!");
            // Refresh tabel data pasien
            loadPatientData();
          }
        } catch (error) {
          console.error('Save patient error:', error);
          alert("Gagal menyimpan data pasien!");
        }
      }

      // Fungsi untuk memuat data pasien
      async function loadPatientData() {
        const tableBody = document.getElementById("patientTableBody");
        
        try {
          // Ambil data dari Supabase
          const { data: storedPatients, error } = await supabase
            .from('patients')
            .select('*')
            .order('tanggal', { ascending: false });

          if (error) {
            console.error('Load patients error:', error);
            patientData = [];
          } else {
            patientData = storedPatients || [];
          }
          
          // Render tabel
          tableBody.innerHTML = "";
          
          if (patientData.length === 0) {
            tableBody.innerHTML = `
              <tr>
                <td colspan="6" class="p-4 text-center text-gray-500">
                  Belum ada data pasien
                </td>
              </tr>
            `;
            return;
          }
          
          patientData.forEach((patient, index) => {
            const row = document.createElement("tr");
            row.className = index % 2 === 0 ? "bg-white" : "bg-gray-50";
            row.innerHTML = `
              <td class="p-3">${patient.client_id}</td>
              <td class="p-3">${patient.demographic.nama}</td>
              <td class="p-3">${patient.demographic.umur}</td>
              <td class="p-3">${new Date(patient.tanggal).toLocaleDateString('id-ID')}</td>
              <td class="p-3">${patient.operator_name}</td>
              <td class="p-3">
                <button class="view-patient-btn text-blue-600 hover:text-blue-800 mr-2" data-id="${patient.client_id}">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="delete-patient-btn text-red-600 hover:text-red-800" data-id="${patient.client_id}">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            `;
            tableBody.appendChild(row);
          });
          
          // Setup event listeners untuk tombol aksi
          document.querySelectorAll(".view-patient-btn").forEach(btn => {
            btn.addEventListener("click", function() {
              const patientId = this.dataset.id;
              viewPatientData(patientId);
            });
          });
          
          document.querySelectorAll(".delete-patient-btn").forEach(btn => {
            btn.addEventListener("click", function() {
              const patientId = this.dataset.id;
              deletePatientData(patientId);
            });
          });
        } catch (error) {
          console.error('Load patients error:', error);
          patientData = [];
        }
      }

      // Fungsi untuk melihat data pasien lengkap
      async function viewPatientData(patientId) {
        try {
          const { data: patient, error } = await supabase
            .from('patients')
            .select('*')
            .eq('client_id', patientId)
            .single();

          if (error || !patient) {
            alert("Data pasien tidak ditemukan!");
            return;
          }
          
          const modalContent = document.getElementById("patientDataContent");
          
          // Render data pasien lengkap
          modalContent.innerHTML = `
            <div class="data-section">
              <h3 class="text-lg font-semibold mb-4">Data Demografi</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><strong>Nama:</strong> ${patient.demographic.nama}</div>
                <div><strong>Jenis Kelamin:</strong> ${patient.demographic.jenisKelamin}</div>
                <div><strong>Umur:</strong> ${patient.demographic.umur}</div>
                <div><strong>Agama:</strong> ${patient.demographic.agama}</div>
                <div><strong>Tanggal Lahir:</strong> ${patient.demographic.tanggalLahir}</div>
                <div><strong>Tempat Lahir:</strong> ${patient.demographic.tempatLahir}</div>
                <div><strong>Pekerjaan:</strong> ${patient.demographic.pekerjaan}</div>
                <div><strong>Bangsa:</strong> ${patient.demographic.bangsa}</div>
                <div><strong>Alamat:</strong> ${patient.demographic.alamat}</div>
                <div><strong>Golongan Darah:</strong> ${patient.demographic.golonganDarah}</div>
                <div><strong>Status:</strong> ${patient.demographic.status}</div>
                <div><strong>No. Telepon:</strong> ${patient.demographic.telepon}</div>
                <div><strong>Tanggungan:</strong> ${patient.demographic.tanggungan}</div>
                <div><strong>Suku/Adat:</strong> ${patient.demographic.suku}</div>
                <div><strong>Berat Badan:</strong> ${patient.demographic.beratBadan} kg</div>
                <div><strong>Tinggi Badan:</strong> ${patient.demographic.tinggiBadan} cm</div>
                <div><strong>Asuransi Kesehatan:</strong> ${patient.demographic.asuransi}</div>
                <div><strong>Sumber Rujukan:</strong> ${patient.demographic.rujukan}</div>
              </div>
            </div>
            
            <div class="data-section">
              <h3 class="text-lg font-semibold mb-4">Data Operator</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><strong>Nama Operator:</strong> ${patient.operator_name}</div>
                <div><strong>NIM:</strong> ${patient.operator_nim}</div>
                <div><strong>ID Klien:</strong> ${patient.client_id}</div>
                <div><strong>Tanggal Pemeriksaan:</strong> ${new Date(patient.tanggal).toLocaleDateString('id-ID')}</div>
              </div>
            </div>
          `;
          
          // Tampilkan modal
          document.getElementById("patientDataModal").classList.remove("hidden");
        } catch (error) {
          console.error('View patient error:', error);
          alert("Terjadi kesalahan saat memuat data pasien!");
        }
      }

      // Fungsi untuk menghapus data pasien
      async function deletePatientData(patientId) {
        if (confirm("Apakah Anda yakin ingin menghapus data pasien ini?")) {
          try {
            const { error } = await supabase
              .from('patients')
              .delete()
              .eq('client_id', patientId);

            if (error) {
              console.error('Delete patient error:', error);
              alert("Gagal menghapus data pasien!");
            } else {
              // Hapus dari array
              patientData = patientData.filter(p => p.client_id !== patientId);
              
              // Refresh tabel
              loadPatientData();
              
              alert("Data pasien berhasil dihapus!");
            }
          } catch (error) {
            console.error('Delete patient error:', error);
            alert("Gagal menghapus data pasien!");
          }
        }
      }

      // Fungsi untuk mencari pasien
      function searchPatient() {
        const searchTerm = document.getElementById("searchPatient").value.toLowerCase();
        const tableRows = document.querySelectorAll("#patientTableBody tr");
        
        tableRows.forEach(row => {
          const patientName = row.querySelector("td:nth-child(2)").textContent.toLowerCase();
          if (patientName.includes(searchTerm)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      // Fungsi untuk mengekspor data pasien ke XLSX
      function exportPatientData() {
        if (patientData.length === 0) {
          alert("Tidak ada data pasien untuk diekspor.");
          return;
        }
        
        // Buat worksheet
        const ws = XLSX.utils.json_to_sheet(patientData.map(p => ({
          "ID Pasien": p.client_id,
          "Nama": p.demographic.nama,
          "Umur": p.demographic.umur,
          "Jenis Kelamin": p.demographic.jenisKelamin,
          "Tanggal Pemeriksaan": new Date(p.tanggal).toLocaleDateString('id-ID'),
          "Operator": p.operator_name,
          "NIM": p.operator_nim
        })));
        
        // Buat workbook
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Data Pasien");
        
        // Ekspor ke file
        XLSX.writeFile(wb, "data_pasien.xlsx");
      }

      // Fungsi untuk mengekspor data pasien tunggal
      function exportSinglePatientData() {
        alert("Fitur ekspor data pasien tunggal akan segera tersedia.");
      }

      // Fungsi untuk mencetak data pasien
      function printPatientData() {
        alert("Fitur pencetakan data pasien akan segera tersedia.");
      }

      // Fungsi untuk memuat data dashboard
      function loadDashboardData() {
        // Update statistik
        document.getElementById("totalPatients").textContent = patientData.length;
        
        // Hitung persentase kondisi baik dan perlu perawatan
        const goodConditionPercentage = patientData.length > 0 ? Math.round(Math.random() * 100) : 0;
        const needTreatmentPercentage = patientData.length > 0 ? 100 - goodConditionPercentage : 0;
        
        document.getElementById("goodCondition").textContent = `${goodConditionPercentage}%`;
        document.getElementById("needTreatment").textContent = `${needTreatmentPercentage}%`;
        
        // Buat chart kondisi gigi
        const conditionCtx = document.getElementById("conditionChart").getContext('2d');
        new Chart(conditionCtx, {
          type: 'doughnut',
          data: {
            labels: ['Baik', 'Perlu Perawatan', 'Kritis'],
            datasets: [{
              data: [goodConditionPercentage, needTreatmentPercentage, 0],
              backgroundColor: ['#10b981', '#f59e0b', '#ef4444']
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'bottom'
              }
            }
          }
        });
        
        // Buat chart kebiasaan pasien
        const habitsCtx = document.getElementById("habitsChart").getContext('2d');
        new Chart(habitsCtx, {
          type: 'bar',
          data: {
            labels: ['Menyikat Gigi 2x/hari', 'Menggunakan Benang Gigi', 'Pemeriksaan Rutin'],
            datasets: [{
              label: 'Persentase',
              data: [75, 40, 60],
              backgroundColor: '#0ea5e9'
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
               